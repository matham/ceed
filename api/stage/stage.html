<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stage &mdash; Ceed  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Stage plugins" href="stage_plugin.html" />
    <link rel="prev" title="Stage API" href="api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Ceed
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blueprint.html">System Blueprint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">CEED Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_code/example_code.html">Example Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apps/apps.html">Ceed Apps</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">The Ceed API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ceed.html">Ceed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis/api.html">Analysis API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../function/api.html">Function API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape/api.html">Shape API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="api.html">Stage API</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Stage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stage-factory-and-plugins">Stage factory and plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stage-basics">Stage basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-a-stage">Running a stage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-computing">Pre-computing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#saving-and-restoring-stages">Saving and restoring stages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reference-stages">Reference stages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#copying-stages">Copying stages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-stage-in-script">Create stage in script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-plugin-stage-example">Custom plugin stage example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-graphics">Custom graphics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="stage_plugin.html">Stage plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="widgets.html">Stage widgets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../view/api.html">Experiment API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/api.html">Storage API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../player.html">Video Player</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../graphics/api.html">Graphics API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../optics/optics.html">Microscope optics V2</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ceed</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../api.html">The Ceed API</a> &raquo;</li>
          <li><a href="api.html">Stage API</a> &raquo;</li>
      <li>Stage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api/stage/stage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="module-ceed.stage"></span><section id="stage">
<span id="stage-api"></span><h1>Stage<a class="headerlink" href="#stage" title="Permalink to this headline"></a></h1>
<p>A <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> combines <code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.shapes</span></code> on the screen with a
<a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">FuncBase</span></code></a> or sequence of
<a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">FuncBase</span></code></a> which determines the intensity of the shapes as
time progresses in the experiment. This module defines the <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>
and associated classes used to store and compute the intensity values during
the experiment.</p>
<section id="stage-factory-and-plugins">
<span id="stage-factory-plugin"></span><h2>Stage factory and plugins<a class="headerlink" href="#stage-factory-and-plugins" title="Permalink to this headline"></a></h2>
<p>The <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> is a store of the defined <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>
sub-classes and customized stage instances. Stage classes/instances
registered with the <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> instance used by the
the GUI are available to the user in the GUI. During analysis, stages are
similarly registered with the <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> instance used in the
analysis and can then be used to get these stages. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># get a function and shape factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">function_factory</span> <span class="o">=</span> <span class="n">FunctionFactoryBase</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape_factory</span> <span class="o">=</span> <span class="n">CeedPaintCanvasBehavior</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># create the stage store, linking to the other factories</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stage_factory</span> <span class="o">=</span> <span class="n">StageFactoryBase</span><span class="p">(</span>
<span class="go">        function_factory=function_factory, shape_factory=shape_factory)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register_all_stages</span><span class="p">(</span><span class="n">stage_factory</span><span class="p">)</span>  <span class="c1"># register plugins</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">StageCls</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CeedStage&#39;</span><span class="p">)</span>  <span class="c1"># get the class</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">StageCls</span>
<span class="go">&lt;class &#39;ceed.stage.CeedStage&#39;&gt;</span>
</pre></div>
</div>
<p>Classes can be registered manually with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.register()</span></code></a> or they can be registered automatically
with <a class="reference internal" href="#ceed.stage.register_all_stages" title="ceed.stage.register_all_stages"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_all_stages()</span></code></a> if they are an internal plugin or
<a class="reference internal" href="#ceed.stage.register_external_stages" title="ceed.stage.register_external_stages"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_external_stages()</span></code></a> for an external plugin. The GUI calls
<a class="reference internal" href="#ceed.stage.register_all_stages" title="ceed.stage.register_all_stages"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_all_stages()</span></code></a> when started as well as
<a class="reference internal" href="#ceed.stage.register_external_stages" title="ceed.stage.register_external_stages"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_external_stages()</span></code></a> if the
<a class="reference internal" href="../../apps/main.html#ceed.main.CeedApp.external_stage_plugin_package" title="ceed.main.CeedApp.external_stage_plugin_package"><code class="xref py py-attr docutils literal notranslate"><span class="pre">external_stage_plugin_package</span></code></a> configuration
variable contains a package name.</p>
<p>See <a class="reference internal" href="stage_plugin.html#module-ceed.stage.plugin" title="ceed.stage.plugin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage.plugin</span></code></a> for details on writing plugins. For details on
how to customize stages, see below for important steps and methods during a
stage’s lifecycle.</p>
<p>To get a stage class registered with <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a>, e.g. the
connonical <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> base class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">StageCls</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CeedStage&#39;</span><span class="p">)</span>  <span class="c1"># get the class</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">StageCls</span>
<span class="go">&lt;class &#39;ceed.stage.CeedStage&#39;&gt;</span>
</pre></div>
</div>
</section>
<section id="stage-basics">
<h2>Stage basics<a class="headerlink" href="#stage-basics" title="Permalink to this headline"></a></h2>
<p>All stages are instances of <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> or any plugin-defined
sub-classes.</p>
<p>A stage is composed of one or more <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.shapes</span></code></a>, a
series of <a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.function.FuncBase</span></code></a> <code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code> that
govern the intensity these shapes take across time, and
sub-<a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a>, that are simultanously evaluated during this
stage.</p>
<p>All stages have a <a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a>, and stages that are available globally
through the <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> and shown as root stages in the GUI have
unique names. To run an experiment you select a named stage to run.</p>
<section id="stage-duration">
<h3>Stage duration<a class="headerlink" href="#stage-duration" title="Permalink to this headline"></a></h3>
<p>Ignoring sub-stages, a stage will sample trhough its <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a>
sequentally until they are all done, <a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.loop</span></code></a> times. After
<a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.loop</span></code></a> times, the stage is done. For example, a stage with
function <code class="docutils literal notranslate"><span class="pre">f1</span></code> and <code class="docutils literal notranslate"><span class="pre">f2</span></code> that <code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.loop`s</span> <span class="pre">3</span> <span class="pre">times,</span> <span class="pre">will</span> <span class="pre">tick</span>
<span class="pre">through</span> <span class="pre">the</span> <span class="pre">functions</span> <span class="pre">as</span> <span class="pre">follows:</span> <span class="pre">``f1,</span> <span class="pre">f2,</span> <span class="pre">f1,</span> <span class="pre">f2,</span> <span class="pre">f1,</span> <span class="pre">f2`</span></code>. At each sample,
all the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.shapes</span></code></a> of the stage (and possibly sub-stages) are
set to the value  in the <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code> range returned by the functions for that
time step.</p>
<p>If there are child <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a> that have their own
<a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.shapes</span></code></a>, we also sample these stages simultanously during each
root stage loop iteration. That means that while shapes associated with the root
stage are updated from the root stage’s functions, the shapes of the sub-stages
currently active are updated from their functions.</p>
<p>E.g. if we have a root stage which contains 4 children <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a>
A, B, C, D:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span>
    <span class="n">A</span>
    <span class="n">B</span>
    <span class="n">C</span>
    <span class="n">D</span>
</pre></div>
</div>
<p>If root’s <a class="reference internal" href="#ceed.stage.CeedStage.order" title="ceed.stage.CeedStage.order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.order</span></code></a> is <code class="docutils literal notranslate"><span class="pre">'serial'</span></code>, then for each root
<a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.loop</span></code></a> iteration, each sub-stage A - D is evaluated sequentially
after the previous sub-stage has finished in the order A -&gt; B -&gt; C -&gt; D.
If it’s <code class="docutils literal notranslate"><span class="pre">'parallel'</span></code>, then each sub-stage is evaluated simultaneously
rather than sequentially.</p>
<p>While the sub-stages are executed in parallel or serially, the root’s
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a> are evaluated and the root’s shapes set to those
values.</p>
<p>If <a class="reference internal" href="#ceed.stage.CeedStage.complete_on" title="ceed.stage.CeedStage.complete_on"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.complete_on</span></code></a> is <code class="docutils literal notranslate"><span class="pre">'any'</span></code> then a loop iteration for the
root stage will be considered completed after all the root’s
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a> are done <strong>and</strong> any of the
<a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a> have completed. The sub-stages that have
not yet completed will just end early.</p>
<p>Otherwise, <a class="reference internal" href="#ceed.stage.CeedStage.complete_on" title="ceed.stage.CeedStage.complete_on"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.complete_on</span></code></a> is <code class="docutils literal notranslate"><span class="pre">'all'</span></code> and a loop iteration for
the root will complete after all the root’s <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a> <strong>and</strong>
all the <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a> have completed.</p>
<p>In all cases, shapes that are not associated with a stage that is
currently being evaluated will be set to transparent. E.g. in the serial
case, shapes that are associated with stage C will be transparent in all
other stages, except if they also appear in those stages.</p>
<p>If a shape occurs in multiple stages (e.g. in both the root and A), then
if the root and A set different color channels (e.g. root sets blue, A sets
green), the shape will will set each channel from each active stage
simultaneously because they don’t conflict. If they do set the same channel,
the sub-stages win over parent stages in the stage tree.</p>
</section>
<section id="color-channels">
<h3>Color channels<a class="headerlink" href="#color-channels" title="Permalink to this headline"></a></h3>
<p>Each stage contains <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.shapes</span></code></a> that are all set to the value
returned by the currently active function in <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a>
for the current time step. That is the function yields a single floating point
value between 0-1, inclusive and all the shapes get set to that value for that
timestep.</p>
<p>However, there are 3 channels to be set; red, green, and blue. You can select
which of these channels the stage sets using <a class="reference internal" href="#ceed.stage.CeedStage.color_r" title="ceed.stage.CeedStage.color_r"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.color_r</span></code></a>,
<a class="reference internal" href="#ceed.stage.CeedStage.color_g" title="ceed.stage.CeedStage.color_g"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.color_g</span></code></a>, and <a class="reference internal" href="#ceed.stage.CeedStage.color_b" title="ceed.stage.CeedStage.color_b"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.color_b</span></code></a> and those channels are
set to the same function value. The remaining channels are not set by this stage
and default to zero if no other parent or sub-stage sets them.</p>
<p>Shapes belonging to sub-stages are not controlled by parent stages, only by the
direct stage(s) that contains them.</p>
<p>If the projector <a class="reference internal" href="../view/controller.html#ceed.view.controller.ViewControllerBase.video_mode" title="ceed.view.controller.ViewControllerBase.video_mode"><code class="xref py py-attr docutils literal notranslate"><span class="pre">video_mode</span></code></a> is
set to <code class="docutils literal notranslate"><span class="pre">&quot;QUAD12X&quot;</span></code>, then the function value is used for all three channels
so it’s grayscale. E.g. even if only <a class="reference internal" href="#ceed.stage.CeedStage.color_r" title="ceed.stage.CeedStage.color_r"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.color_r</span></code></a> and
<a class="reference internal" href="#ceed.stage.CeedStage.color_b" title="ceed.stage.CeedStage.color_b"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.color_b</span></code></a> are true, all three red, green, and blue channels
will be set to the same value . If the channels are set to different values
in parallel stages, the channels are first averaged.</p>
</section>
<section id="stage-lifecycle">
<h3>Stage lifecycle<a class="headerlink" href="#stage-lifecycle" title="Permalink to this headline"></a></h3>
<p>The ultimate use of a stage is to sample it for all timepoints that the stage is
active. Before the stage is ready, however, it needs to be initialized. Folowing
are the overall steps performed by <a class="reference internal" href="#ceed.stage.StageFactoryBase.tick_stage" title="ceed.stage.StageFactoryBase.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.tick_stage()</span></code></a> that
initialize a stage before running it as an experiment.</p>
<p>Starting with a stage, first the stage is coped and all
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a> resampled using
<a class="reference internal" href="#ceed.stage.CeedStage.copy_and_resample" title="ceed.stage.CeedStage.copy_and_resample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.copy_and_resample()</span></code></a>. Then the stage is renamed to
<a class="reference internal" href="#ceed.stage.last_experiment_stage_name" title="ceed.stage.last_experiment_stage_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">last_experiment_stage_name</span></code></a>. This displays the copied stage to be run in
the GUI under the name <a class="reference internal" href="#ceed.stage.last_experiment_stage_name" title="ceed.stage.last_experiment_stage_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">last_experiment_stage_name</span></code></a>.</p>
<p>Next, we call <a class="reference internal" href="#ceed.stage.CeedStage.init_stage_tree" title="ceed.stage.CeedStage.init_stage_tree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.init_stage_tree()</span></code></a> on the root stage. This
calls <a class="reference internal" href="../function/function.html#ceed.function.FuncBase.init_func_tree" title="ceed.function.FuncBase.init_func_tree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_func_tree()</span></code></a> on all the stage’s
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a> and recursively calls
<a class="reference internal" href="#ceed.stage.CeedStage.init_stage_tree" title="ceed.stage.CeedStage.init_stage_tree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.init_stage_tree()</span></code></a> on all the sub-<a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a>
as well as some initialization.</p>
<p>Next, using <a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.apply_pre_compute()</span></code></a> it pre-computes all the stages
and functions for which it is enabled. See below for details. Finally, the
stage is sampled, a sample at a time using the <a class="reference internal" href="#ceed.stage.CeedStage.tick_stage" title="ceed.stage.CeedStage.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.tick_stage()</span></code></a>
generator. This generator either returns the pre-comuted values, computed
before the experiment started if enabled, or
it computes the sample values and yields them until the root stage is done.</p>
<p>When the stage is done, it internally raises a <a class="reference internal" href="#ceed.stage.StageDoneException" title="ceed.stage.StageDoneException"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageDoneException</span></code></a>.
This gets caught and Ceed knows that the stage is done. At the end of each loop
iteration and at the end of the overall stage it calls
<a class="reference internal" href="#ceed.stage.CeedStage.finalize_loop_iteration" title="ceed.stage.CeedStage.finalize_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.finalize_loop_iteration()</span></code></a>, and
<a class="reference internal" href="#ceed.stage.CeedStage.finalize_stage" title="ceed.stage.CeedStage.finalize_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.finalize_stage()</span></code></a>, respectively.</p>
</section>
<section id="customizing-stages">
<h3>Customizing stages<a class="headerlink" href="#customizing-stages" title="Permalink to this headline"></a></h3>
<p>A <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> has multiple methods that can be overwritten by a plugin.
Following are some relevant methods - see their docs for more details.</p>
<ul>
<li><p>If the stage generates the samples directly without using the function
classes, <a class="reference internal" href="#ceed.stage.CeedStage.resample_parameters" title="ceed.stage.CeedStage.resample_parameters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.resample_parameters()</span></code></a> needs to be augmented if
the stage has any randomness.</p></li>
<li><p><a class="reference internal" href="#ceed.stage.CeedStage.init_stage_tree" title="ceed.stage.CeedStage.init_stage_tree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.init_stage_tree()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">FuncBase.init_func()</span></code>,
<a class="reference internal" href="#ceed.stage.CeedStage.init_loop_iteration" title="ceed.stage.CeedStage.init_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.init_loop_iteration()</span></code></a>,
<a class="reference internal" href="#ceed.stage.CeedStage.finalize_loop_iteration" title="ceed.stage.CeedStage.finalize_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.finalize_loop_iteration()</span></code></a>, and
<a class="reference internal" href="#ceed.stage.CeedStage.finalize_stage" title="ceed.stage.CeedStage.finalize_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.finalize_stage()</span></code></a> may be augmented if any of these stage
lifecycle events requires additional initialization/finalization.</p></li>
<li><p><a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.evaluate_stage()</span></code></a> is the most approperiate method to overwrite
to have the stage directly compute values for the shapes. By default it
goes through all the loops and for each loop it goes through all the functions
and sub-stages. It can be overwritten instead to just yield any specific
desired values.</p></li>
<li><p><a class="reference internal" href="#ceed.stage.CeedStage.tick_stage" title="ceed.stage.CeedStage.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.tick_stage()</span></code></a> can be overwritten, but it requires more care.
Since this yields the values directly and is called directly by the higher
level code, if <a class="reference internal" href="#ceed.stage.CeedStage.tick_stage" title="ceed.stage.CeedStage.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.tick_stage()</span></code></a> is overwritten it won’t
participate in pre-computing or any other stage behaviors, so pre-computing
should be disabled by setting <a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.disable_pre_compute</span></code></a> to True.
See the method for other requirements.</p>
<p>Additionally, if it’s a root stage, it should pad the stage runtime to
<a class="reference internal" href="#ceed.stage.CeedStage.pad_stage_ticks" title="ceed.stage.CeedStage.pad_stage_ticks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.pad_stage_ticks</span></code></a>, if nonzero.</p>
</li>
<li><p><a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.apply_pre_compute()</span></code></a>, <a class="reference internal" href="#ceed.stage.CeedStage.runtime_functions" title="ceed.stage.CeedStage.runtime_functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.runtime_functions</span></code></a>, and
<a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.runtime_stage</span></code></a> can be overwritten/manually set, but great
care must be taken. See their docs and the pre-computing section below.</p></li>
<li><p>See the stage’s properties for additional customizations.</p></li>
</ul>
<p>In all cases, <a class="reference internal" href="#ceed.stage.CeedStage.get_state" title="ceed.stage.CeedStage.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.get_state()</span></code></a> may also need to
be augmented to return any parameters that are part of the instance, otherwise
they won’t be copied when the stage is internally copied and the stage will use
incorrect values when run e.g. in the second process that runs the experiment.</p>
<p>If stages are pre-computed, it may not have any side-effects, because they
would occur before the experiment during pre-computing. So if these side-effects
are needed (e.g. drug delivery), either turn off pre-computing for the stage
or set its function’s duration to negative to disable it for the function and
consequently the stage containing it.</p>
</section>
</section>
<section id="running-a-stage">
<h2>Running a stage<a class="headerlink" href="#running-a-stage" title="Permalink to this headline"></a></h2>
<p>Once we have a stage, shapes, and a function, the stage is ready to be run with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.tick_stage" title="ceed.stage.StageFactoryBase.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.tick_stage()</span></code></a></p>
<p>The following is a worked through example showing
the steps the Ceed GUI goes through automatically to run a stage and what you
should do to manually run a stage for testing purposes.</p>
<p>First create the stage, shape, and function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ceed.stage</span> <span class="kn">import</span> <span class="n">CeedStage</span><span class="p">,</span> <span class="n">StageFactoryBase</span><span class="p">,</span> <span class="n">register_all_stages</span><span class="p">,</span> \
    <span class="n">StageDoneException</span>
<span class="kn">from</span> <span class="nn">ceed.function</span> <span class="kn">import</span> <span class="n">FunctionFactoryBase</span><span class="p">,</span> <span class="n">register_all_functions</span>
<span class="kn">from</span> <span class="nn">ceed.shape</span> <span class="kn">import</span> <span class="n">CeedPaintCanvasBehavior</span>
<span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>

<span class="c1"># create function/shape/stage factories to house functions/shapes/stages</span>
<span class="n">function_factory</span> <span class="o">=</span> <span class="n">FunctionFactoryBase</span><span class="p">()</span>
<span class="c1"># register built-in plugins</span>
<span class="n">register_all_functions</span><span class="p">(</span><span class="n">function_factory</span><span class="p">)</span>
<span class="n">shape_factory</span> <span class="o">=</span> <span class="n">CeedPaintCanvasBehavior</span><span class="p">()</span>
<span class="n">stage_factory</span> <span class="o">=</span> <span class="n">StageFactoryBase</span><span class="p">(</span>
    <span class="n">function_factory</span><span class="o">=</span><span class="n">function_factory</span><span class="p">,</span> <span class="n">shape_factory</span><span class="o">=</span><span class="n">shape_factory</span><span class="p">)</span>
<span class="c1"># register built-in plugins</span>
<span class="n">register_all_stages</span><span class="p">(</span><span class="n">stage_factory</span><span class="p">)</span>

<span class="c1"># create a 3 second duration function, that loops twice</span>
<span class="n">LinearFuncCls</span> <span class="o">=</span> <span class="n">function_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LinearFunc&#39;</span><span class="p">)</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">LinearFuncCls</span><span class="p">(</span>
    <span class="n">function_factory</span><span class="o">=</span><span class="n">function_factory</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">.33</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Function name: &quot;</span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
<span class="c1"># and a circle shape</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">shape_factory</span><span class="o">.</span><span class="n">create_shape</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="c1"># and add it</span>
<span class="n">shape_factory</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shape name: &quot;</span><span class="si">{</span><span class="n">circle</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
<span class="c1"># and finally the stage</span>
<span class="n">stage</span> <span class="o">=</span> <span class="n">CeedStage</span><span class="p">(</span>
    <span class="n">stage_factory</span><span class="o">=</span><span class="n">stage_factory</span><span class="p">,</span> <span class="n">function_factory</span><span class="o">=</span><span class="n">function_factory</span><span class="p">,</span>
    <span class="n">shape_factory</span><span class="o">=</span><span class="n">shape_factory</span><span class="p">)</span>
<span class="c1"># and add it to factory</span>
<span class="n">stage_factory</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Stage name: &quot;</span><span class="si">{</span><span class="n">stage</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

<span class="c1"># now add the function and shape to stage</span>
<span class="n">stage</span><span class="o">.</span><span class="n">add_func</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
<span class="n">stage</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="c1"># stage will only set red and blue channels</span>
<span class="n">stage</span><span class="o">.</span><span class="n">color_r</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">color_b</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">stage</span><span class="o">.</span><span class="n">color_g</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Once ready, we can run through the stage manually like Ceed does during an
experiment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># now create the generator that will iterate through all the stage shape</span>
<span class="c1"># values at a frame rate of 2Hz</span>
<span class="n">tick</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">tick_stage</span><span class="p">(</span>
    <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_rate</span><span class="o">=</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stage_name</span><span class="o">=</span><span class="n">stage</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># start it</span>
<span class="nb">next</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span>
<span class="c1"># start with time zero, the same as t_start</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># send the next global time value as multiples of the period (1 / 2)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># this gets the raw intensity values</span>
        <span class="n">shapes_intensity_raw</span> <span class="o">=</span> <span class="n">tick</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">StageDoneException</span><span class="p">:</span>
        <span class="c1"># when the stage is done, it raises this exception</span>
        <span class="k">break</span>

    <span class="c1"># convert raw intensity to final color intensity. This function can</span>
    <span class="c1"># also e.g. convert the colors for quad mode where it&#39;s gray-scale</span>
    <span class="n">shapes_intensity</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">set_shape_gl_color_values</span><span class="p">(</span>
        <span class="n">shape_views</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape_values</span><span class="o">=</span><span class="n">shapes_intensity_raw</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;time=</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">s,      intensity=&quot;</span><span class="si">{</span><span class="n">shapes_intensity</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The above will print the following when run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Linear&quot;</span>
<span class="n">Shape</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span>
<span class="n">Stage</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Stage-2&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0, 0, 0, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>  <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.165, 0, 0.165, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.33, 0, 0.33, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>  <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.495, 0, 0.495, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.66, 0, 0.66, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>  <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.825, 0, 0.825, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">3</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0, 0, 0, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">7</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>  <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.165, 0, 0.165, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">4</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.33, 0, 0.33, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">9</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>  <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.495, 0, 0.495, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">5</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.66, 0, 0.66, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">11</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.825, 0, 0.825, 1)]&quot;</span>
</pre></div>
</div>
<p>Some important points to notice above: The global clock is run with multiples
of the period. This period is the projector frame rate, and when ticking we must
only increment the time by single period increments. This is required for
stage pre-computing to work because once pre-computed, we have a list of
intensity values with the expectation that each value corresponds to single
period increment because that’s how they are pre-computed.</p>
<p>To skip a frame, you must still tick that frame time, but you can discard the
yielded value. This is how Ceed drops frames when the GPU takes too long to
render a frame and we must compensate by dropping a frame.</p>
<p>One can also use the stage factory to compute all the intensity values without
having to iterate as follows. Once we have the stage ready:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="c1"># now create the generator that will iterate through all the stage shape</span>
<span class="c1"># values at a frame rate of 2Hz</span>
<span class="n">intensity</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">get_all_shape_values</span><span class="p">(</span>
    <span class="n">frame_rate</span><span class="o">=</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stage_name</span><span class="o">=</span><span class="n">stage</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
</pre></div>
</div>
<p>This prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>defaultdict(&lt;class &#39;list&#39;&gt;,
            {&#39;Shape&#39;: [(0, 0, 0, 1),
                       (0.165, 0, 0.165, 1),
                       (0.33, 0, 0.33, 1),
                       (0.495, 0, 0.495, 1),
                       (0.66, 0, 0.66, 1),
                       (0.825, 0, 0.825, 1),
                       (0, 0, 0, 1),
                       (0.165, 0, 0.165, 1),
                       (0.33, 0, 0.33, 1),
                       (0.495, 0, 0.495, 1),
                       (0.66, 0, 0.66, 1),
                       (0.825, 0, 0.825, 1)]})
</pre></div>
</div>
</section>
<section id="pre-computing">
<span id="pre-compute"></span><h2>Pre-computing<a class="headerlink" href="#pre-computing" title="Permalink to this headline"></a></h2>
<p>By default, during an experiment as the global clock ticks in multiple of the
period, the root stage is given the current time and it compute the intensity
values for all the shapes from its <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a> and
sub-<a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a>. If the intensity computation is slow, the CPU
may miss updating the GPU with a new frame before the next frame deadline
and consequently we will need to drop a frame.</p>
<p>Ceed can pre-compute the intensity values for all the shapes for all time
points by virtually running through the whole experiment and recording the
intensities yielded by the stage into a flat list. Then during the real
experiment it simply looks up the intensity from the list by sequentially
iterating through the list.</p>
<p>This works because the global time is sequential consecutive multiples of the
period both during the virtual computation and during the replay, so we can
simply count frames to locate the desired intensity.</p>
<p>Pre-computing can be enabled in the GUI through the
<a class="reference internal" href="../view/controller.html#ceed.view.controller.ViewControllerBase.pre_compute_stages" title="ceed.view.controller.ViewControllerBase.pre_compute_stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pre_compute_stages</span></code></a> property.</p>
<p>Not all stages can be pre-computed. A stage could have functions that are
infinite in duration (i.e. negarive <a class="reference internal" href="../function/function.html#ceed.function.FuncBase.duration" title="ceed.function.FuncBase.duration"><code class="xref py py-attr docutils literal notranslate"><span class="pre">duration</span></code></a>,
e.g. when it’s waiting for a switch to go ON) or a stage can be manually
opted out from pre-computing by setting <a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.disable_pre_compute</span></code></a>
to True. In that case, all other functions and stages that are not infinite
and not opted would will still be pre-computed as much as possible.</p>
<p>See <a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.disable_pre_compute</span></code></a>, <a class="reference internal" href="#ceed.stage.CeedStage.runtime_functions" title="ceed.stage.CeedStage.runtime_functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.runtime_functions</span></code></a>,
<a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.runtime_stage</span></code></a>, and <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.can_pre_compute</span></code></a> for
more details.</p>
</section>
<section id="saving-and-restoring-stages">
<h2>Saving and restoring stages<a class="headerlink" href="#saving-and-restoring-stages" title="Permalink to this headline"></a></h2>
<p>Functions can be saved as a data dictionary and later restored into a function
instance. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">function</span> <span class="o">=</span> <span class="n">LinearFunc</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">function_factory</span><span class="o">=</span><span class="n">function_factory</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">.33</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">circle</span> <span class="o">=</span> <span class="n">shape_factory</span><span class="o">.</span><span class="n">create_shape</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape_factory</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stage</span> <span class="o">=</span> <span class="n">CeedStage</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stage_factory</span><span class="o">=</span><span class="n">stage_factory</span><span class="p">,</span> <span class="n">function_factory</span><span class="o">=</span><span class="n">function_factory</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">shape_factory</span><span class="o">=</span><span class="n">shape_factory</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stage</span><span class="o">.</span><span class="n">add_func</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stage</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stage_factory</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">state</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">state</span>
<span class="go">{&#39;cls&#39;: &#39;CeedStage&#39;,</span>
<span class="go"> &#39;color_b&#39;: True,</span>
<span class="go"> &#39;color_g&#39;: False,</span>
<span class="go"> &#39;color_r&#39;: False,</span>
<span class="go"> &#39;complete_on&#39;: &#39;all&#39;,</span>
<span class="go"> &#39;disable_pre_compute&#39;: False,</span>
<span class="go"> &#39;functions&#39;: [{&#39;b&#39;: 0.0,</span>
<span class="go">                &#39;cls&#39;: &#39;LinearFunc&#39;,</span>
<span class="go">                &#39;duration&#39;: 3,</span>
<span class="go">                &#39;loop&#39;: 2,</span>
<span class="go">                &#39;m&#39;: 0.33,</span>
<span class="go">                &#39;name&#39;: &#39;Linear&#39;,</span>
<span class="go">                &#39;noisy_parameter_samples&#39;: {},</span>
<span class="go">                &#39;noisy_parameters&#39;: {},</span>
<span class="go">                &#39;t_offset&#39;: 0.0,</span>
<span class="go">                &#39;timebase_denominator&#39;: 1,</span>
<span class="go">                &#39;timebase_numerator&#39;: 0}],</span>
<span class="go"> &#39;name&#39;: &#39;Stage-2&#39;,</span>
<span class="go"> &#39;order&#39;: &#39;serial&#39;,</span>
<span class="go"> &#39;shapes&#39;: [{&#39;keep_dark&#39;: False, &#39;name&#39;: &#39;Shape&#39;}],</span>
<span class="go"> &#39;stages&#39;: []}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># this is how we create a stage from state</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_stage</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">make_stage</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_stage</span>
<span class="go">&lt;ceed.stage.CeedStage: &quot;Stage&quot; children=(1, 0), at 0x22c2f3b7898&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_stage</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
<span class="go">{&#39;cls&#39;: &#39;CeedStage&#39;,</span>
<span class="go"> &#39;color_b&#39;: True,</span>
<span class="go"> &#39;color_g&#39;: False,</span>
<span class="go"> &#39;color_r&#39;: False,</span>
<span class="go"> ...</span>
<span class="go"> &#39;name&#39;: &#39;Stage&#39;,</span>
<span class="go"> &#39;order&#39;: &#39;serial&#39;,</span>
<span class="go"> &#39;shapes&#39;: [{&#39;keep_dark&#39;: False, &#39;name&#39;: &#39;Shape&#39;}],</span>
<span class="go"> &#39;stages&#39;: []}</span>
</pre></div>
</div>
<p>If you notice, <code class="docutils literal notranslate"><span class="pre">name</span></code> was not restored to the new stage. That’s because
<code class="docutils literal notranslate"><span class="pre">name</span></code> is only restored if we pass <code class="docutils literal notranslate"><span class="pre">clone=True</span></code> as name is considered an
internal property and not always user-customizable. Because we ensure
each stage’s name in the GUI is unique. E.g. with clone:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_stage</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">make_stage</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">clone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_stage</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
<span class="go">{&#39;cls&#39;: &#39;CeedStage&#39;,</span>
<span class="go"> ...</span>
<span class="go"> &#39;name&#39;: &#39;Stage-2&#39;,</span>
<span class="go"> &#39;stages&#39;: []}</span>
</pre></div>
</div>
<p>A fundumental part of Ceed is copying and reconstructing stage objects.
E.g. this is required to recover functions from a template file, from old data,
or even to be able to run the experiment because it is run from a second
process. Consequently, anything required for the stage to be reconstructed
must be returned by <a class="reference internal" href="#ceed.stage.CeedStage.get_state" title="ceed.stage.CeedStage.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.get_state()</span></code></a>.</p>
</section>
<section id="reference-stages">
<h2>Reference stages<a class="headerlink" href="#reference-stages" title="Permalink to this headline"></a></h2>
<p>Stages can contain other <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stages</span></code></a> as children. Instead of
copying stages around we want to be able to reference another stage and add
that reference as a child of a stage. This is useful so that these sub-stages
update when the original stage’s parameters are updated. This is mostly meant
to be used from the GUI, although work fine otherwise.</p>
<p><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> allows one to reference stages in such a manner.
Instead of copying a stage, just get a reference to it with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="ceed.stage.StageFactoryBase.get_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.get_stage_ref()</span></code></a> and add it to another stage.</p>
<p>When removed and destroyed, such stage references must be explicitly released
with <a class="reference internal" href="#ceed.stage.StageFactoryBase.return_stage_ref" title="ceed.stage.StageFactoryBase.return_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.return_stage_ref()</span></code></a>, otherwise the original stage
cannot be deleted in the GUI.</p>
<p>Methods that accept stages (such as <a class="reference internal" href="#ceed.stage.CeedStage.add_stage" title="ceed.stage.CeedStage.add_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.add_stage()</span></code></a>) should also
typically accept <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> stages.</p>
<p><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> cannot be used directly during an experiment, unlike
normal stages. Therefore, they or any stages that contain them must first copy
them and expand them to refer to the orignal stages being referenced before
using them, with <a class="reference internal" href="#ceed.stage.CeedStage.copy_expand_ref" title="ceed.stage.CeedStage.copy_expand_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.copy_expand_ref()</span></code></a> or
<code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStageRef.copy_expand_ref()</span></code>.</p>
<p>E.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stage</span> <span class="o">=</span> <span class="n">CeedStage</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stage</span>
<span class="go">&lt;ceed.stage.CeedStage: &quot;Stage-2&quot; children=(1, 0), at 0x258b6de3c18&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref_stage</span> <span class="o">=</span> <span class="n">stage_factory</span><span class="o">.</span><span class="n">get_stage_ref</span><span class="p">(</span><span class="n">stage</span><span class="o">=</span><span class="n">stage</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref_stage</span>
<span class="go">&lt;ceed.stage.CeedStageRef object at 0x00000258B6DE8128&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref_stage</span><span class="o">.</span><span class="n">stage</span>
<span class="go">&lt;ceed.stage.CeedStage: &quot;Stage-2&quot; children=(1, 0), at 0x258b6de3c18&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stage_factory</span><span class="o">.</span><span class="n">return_stage_ref</span><span class="p">(</span><span class="n">ref_stage</span><span class="p">)</span>
</pre></div>
</div>
<p>Before an experiment using a stage is run, the stage and all its sub-stages and
stage functions that are such references are expanded and copied.</p>
</section>
<section id="copying-stages">
<h2>Copying stages<a class="headerlink" href="#copying-stages" title="Permalink to this headline"></a></h2>
<p>Stages can be copied automatically using <code class="docutils literal notranslate"><span class="pre">deepcopy</span></code> or
<a class="reference internal" href="#ceed.stage.CeedStage.copy_expand_ref" title="ceed.stage.CeedStage.copy_expand_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.copy_expand_ref()</span></code></a>. The former makes a full copy of all the
stages, but any <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> stages will only copy the
<a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a>, not the original stage being refered to. The latter,
instead of copying the <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a>, will replace any
<a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> with copies of the class it refers to.</p>
<p>Stages can be manually copied with <a class="reference internal" href="#ceed.stage.CeedStage.get_state" title="ceed.stage.CeedStage.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.get_state()</span></code></a> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.set_state()</span></code> (although <a class="reference internal" href="#ceed.stage.StageFactoryBase.make_stage" title="ceed.stage.StageFactoryBase.make_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.make_stage()</span></code></a> is
more appropriate for end-user creation).</p>
</section>
<section id="create-stage-in-script">
<h2>Create stage in script<a class="headerlink" href="#create-stage-in-script" title="Permalink to this headline"></a></h2>
<p>A stage complete with functions and shapes can be created in a script,
saved to a yaml file, and then imported from the GUI ready to be
used in an experiment. See
<code class="xref py py-meth docutils literal notranslate"><span class="pre">save_config_to_yaml()</span></code>
for an example.</p>
</section>
<section id="custom-plugin-stage-example">
<h2>Custom plugin stage example<a class="headerlink" href="#custom-plugin-stage-example" title="Permalink to this headline"></a></h2>
<p>As explained above, plugins can register customized <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>
sub-classes to be included in the GUI. Following is an example of how
<a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.evaluate_stage()</span></code></a> can be overwritten.</p>
<p>By default the <a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.evaluate_stage()</span></code></a> generator cycles through
<a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.loop</span></code></a> times and for each loop iteration it ticks through all
the stage’s <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.functions</span></code></a>, setting the stage’s shapes to their
values in addition to ticking through the sub-stages simultaniously and then
yielding.</p>
<p><a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.evaluate_stage()</span></code></a> can be safely overwritten to yield directly
whatever values you wish ignoring any functions or sub-stages.</p>
<p>E.g. if you have a shape in the stage named <code class="docutils literal notranslate"><span class="pre">&quot;circle&quot;</span></code> (in the GUI this shape
will have to be added to the stage) and you want its RGB value to to be
(0.5, 0, 0) for 2 frames, (0, 0.6, 0) for 3 frames, and finally (0, 0.2, 0.1)
for 4 frames for a total experiment duration of 9 frames you would write the
following sub-class in the stage plugin:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SlowStage</span><span class="p">(</span><span class="n">CeedStage</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">evaluate_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">last_end_t</span><span class="p">):</span>
        <span class="c1"># always get the first time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_start</span> <span class="o">=</span> <span class="n">t</span> <span class="o">=</span> <span class="k">yield</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="c1"># r, g, b, a values. a (alpha) should be None</span>
            <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="c1"># this yields so GUI can use the change shape colors</span>
            <span class="n">t</span> <span class="o">=</span> <span class="k">yield</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">t</span> <span class="o">=</span> <span class="k">yield</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">t</span> <span class="o">=</span> <span class="k">yield</span>

        <span class="c1"># this time value was not used and this effectively makes the</span>
        <span class="c1"># stage 9 samples long, and it ends on the last sample so</span>
        <span class="c1"># that last time will be used as start of next stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_end</span> <span class="o">=</span> <span class="n">t</span>
        <span class="c1"># raising this exception is how we indicate we&#39;re done</span>
        <span class="k">raise</span> <span class="n">StageDoneException</span>
</pre></div>
</div>
<p>The above class will behave correctly whether the stage is pre-computed or not
because either way it’s called to get the values. See
<a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.evaluate_stage()</span></code></a> for further details.</p>
<p>To add stage settings to the GUI, see <a class="reference internal" href="#ceed.stage.CeedStage.get_settings_display" title="ceed.stage.CeedStage.get_settings_display"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.get_settings_display()</span></code></a>
and the CSV stage plugin implamentation.</p>
<p>Other methods could potentially also be overwritten to hook into the stage
lifecycle, but they generally require more care. See all <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>
methods and below for further details.</p>
</section>
<section id="custom-graphics">
<h2>Custom graphics<a class="headerlink" href="#custom-graphics" title="Permalink to this headline"></a></h2>
<p>Besides the shapes drawn in the Ceed GUI or script generated, stages could
add arbitrary Kivy GL graphics to the experiment screen and update them
during an experiment. This e.g. allows the display of a circle whose intensity
falls off as it’s farther from the center of the circle.</p>
<p><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> provides the following methods to add, update, and remove
these graphics for an experiment: <a class="reference internal" href="#ceed.stage.CeedStage.add_gl_to_canvas" title="ceed.stage.CeedStage.add_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_gl_to_canvas()</span></code></a>,
<a class="reference internal" href="#ceed.stage.CeedStage.set_gl_colors" title="ceed.stage.CeedStage.set_gl_colors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_gl_colors()</span></code></a>, and <a class="reference internal" href="#ceed.stage.CeedStage.remove_gl_from_canvas" title="ceed.stage.CeedStage.remove_gl_from_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_gl_from_canvas()</span></code></a>.</p>
<p>Additionally, like GUI drawn shapes that automatically log the shape intensity
for each frame to be accessible from
<a class="reference internal" href="../analysis/analysis.html#ceed.analysis.CeedDataReader.shapes_intensity" title="ceed.analysis.CeedDataReader.shapes_intensity"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes_intensity</span></code></a>, stages can overwrite
<a class="reference internal" href="#ceed.stage.CeedStage.get_stage_shape_names" title="ceed.stage.CeedStage.get_stage_shape_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_stage_shape_names()</span></code></a> to add names and use those names to
log arbitrary 4-byte (nominally RGBA for shapes) values for each frame.
These values are also displayed in the graph preview window for all shapes
in the GUI. However, you have to ensure to compute and log the rgba data during
each tick.</p>
<p>See the example plugins in the examples directory.</p>
<dl class="simple">
<dt>TODO: if a function or stage has zero duration, any data events logged during</dt><dd><p>intitialization is not logged if pre-computing. Log these as well. Similarly,
logs created after the last frame of a stage/function is not logged when
pre-computing.</p>
</dd>
</dl>
<dl class="py exception">
<dt class="sig sig-object py" id="ceed.stage.StageDoneException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">StageDoneException</span></span><a class="headerlink" href="#ceed.stage.StageDoneException" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Raised as a signal by a <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> when it is done.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="ceed.stage.StageType">
<span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">StageType</span></span><a class="headerlink" href="#ceed.stage.StageType" title="Permalink to this definition"></a></dt>
<dd><p>The type-hint type for <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>.</p>
<p>alias of TypeVar(‘StageType’, bound=<a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>)</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="ceed.stage.CeedStageOrRefInstance">
<span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">CeedStageOrRefInstance</span></span><a class="headerlink" href="#ceed.stage.CeedStageOrRefInstance" title="Permalink to this definition"></a></dt>
<dd><p>Instance of either <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> or <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a>.</p>
<p>alias of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>, <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a>]</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="ceed.stage.last_experiment_stage_name">
<span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">last_experiment_stage_name</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'experiment_sampled'</span></em><a class="headerlink" href="#ceed.stage.last_experiment_stage_name" title="Permalink to this definition"></a></dt>
<dd><p>The stage name used for the last experiment run. This name cannot be used
by a stage and this stage is overwritten after each experiment run.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">StageFactoryBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function_factory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape_factory</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.StageFactoryBase" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">kivy._event.EventDispatcher</span></code></p>
<p>A global store of the defined <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> classes and
customized stage instances.</p>
<p>Stages in the factory are displayed to the user in the GUI. Similarly,
when a user creates a custom stage in the GUI, it’s added here
automatically.</p>
<p>See <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for details.</p>
<dl class="field-list">
<dt class="field-odd">Events</dt>
<dd class="field-odd"><dl>
<dt><cite>on_changed</cite>:</dt><dd><p>Triggered whenever a stage is added or removed from the factory.</p>
</dd>
<dt>on_data_event:</dt><dd><p>The event is dispatched by stages whenever the wish to log
something. During an experiment, this data is captured and
recorded in the file.</p>
<p>To dispatch, you must pass the function’s
<a class="reference internal" href="../utils.html#ceed.utils.CeedWithID.ceed_id" title="ceed.utils.CeedWithID.ceed_id"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ceed_id</span></code></a>
and a string indicating the event type. You can also pass arbitrary
arguments that gets recorded as well. E.g.
<code class="docutils literal notranslate"><span class="pre">stage_factory.dispatch('on_data_event',</span> <span class="pre">stage.ceed_id,</span> <span class="pre">'drug',</span>
<span class="pre">.4,</span> <span class="pre">'h2o')</span></code>.</p>
<p>See <a class="reference internal" href="../analysis/analysis.html#ceed.analysis.CeedDataReader.event_data" title="ceed.analysis.CeedDataReader.event_data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">event_data</span></code></a> for details
on default events as well as data type and argument requirements.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.stage_names">
<span class="sig-name descname"><span class="pre">stage_names</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.stage_names" title="Permalink to this definition"></a></dt>
<dd><p>A dict of all the stages whose keys are the stage <a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a>
and whose values are the corresponding <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> instances.</p>
<p>Contains stages added with <a class="reference internal" href="#ceed.stage.StageFactoryBase.add_stage" title="ceed.stage.StageFactoryBase.add_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_stage()</span></code></a> as well as those
automatically created and added when <a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a> is called on a class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stage_factory</span><span class="o">.</span><span class="n">stage_names</span>
<span class="go">{&#39;Stage&#39;: &lt;ceed.stage.CeedStage at 0x1da866f00b8&gt;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.shape_factory">
<span class="sig-name descname"><span class="pre">shape_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><span class="pre">ceed.shape.CeedPaintCanvasBehavior</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.shape_factory" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedPaintCanvasBehavior</span></code></a> instance that contains
or is associated with all the shapes used in the stages.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.function_factory">
<span class="sig-name descname"><span class="pre">function_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.FunctionFactoryBase" title="ceed.function.FunctionFactoryBase"><span class="pre">ceed.function.FunctionFactoryBase</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.function_factory" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="../function/function.html#ceed.function.FunctionFactoryBase" title="ceed.function.FunctionFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionFactoryBase</span></code></a> instance that contains
or is associated with all the functions used in the stages.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.stages">
<span class="sig-name descname"><span class="pre">stages</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.stages" title="Permalink to this definition"></a></dt>
<dd><p>The list of the currently available <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> instances added
with <a class="reference internal" href="#ceed.stage.StageFactoryBase.add_stage" title="ceed.stage.StageFactoryBase.add_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_stage()</span></code></a>.</p>
<p>These stages are listed in the GUI and can be used by name to start a stage
to run.</p>
<p>It does not include the instances automatically created and stored in
<a class="reference internal" href="#ceed.stage.StageFactoryBase.stages_inst_default" title="ceed.stage.StageFactoryBase.stages_inst_default"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages_inst_default</span></code></a> when you <a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a> a stage class.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.stages_cls">
<span class="sig-name descname"><span class="pre">stages_cls</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.StageType" title="ceed.stage.StageType"><span class="pre">ceed.stage.StageType</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{}</span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.stages_cls" title="Permalink to this definition"></a></dt>
<dd><p>Dict whose keys is the name of the stage classes registered
with <a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a> and whose values is the corresponding classes.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stage_factory</span><span class="o">.</span><span class="n">stages_cls</span>
<span class="go">{&#39;CeedStage&#39;: ceed.stage.CeedStage}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.stages_inst_default">
<span class="sig-name descname"><span class="pre">stages_inst_default</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{}</span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.stages_inst_default" title="Permalink to this definition"></a></dt>
<dd><p>Dict whose keys is the function <a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a> and whose values
are the corresponding stage instances.</p>
<p>Contains only the stages that are automatically created and added when
<a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a> is called on a class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stage_factory</span><span class="o">.</span><span class="n">stages_inst_default</span>
<span class="go">{&#39;Stage&#39;: &lt;ceed.stage.CeedStage at 0x1da866f00b8&gt;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.unique_names">
<span class="sig-name descname"><span class="pre">unique_names</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../utils.html#ceed.utils.UniqueNames" title="ceed.utils.UniqueNames"><span class="pre">ceed.utils.UniqueNames</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.unique_names" title="Permalink to this definition"></a></dt>
<dd><p>A set that tracks existing stage names to help us ensure all global
stages have unique names.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.plugin_sources">
<span class="sig-name descname"><span class="pre">plugin_sources</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{}</span></em><a class="headerlink" href="#ceed.stage.StageFactoryBase.plugin_sources" title="Permalink to this definition"></a></dt>
<dd><p>A dictionary of the names of all the plugin packages imported, mapped to
the python file contents of the directories in the package. Each value is a
list of tuples.</p>
<p>The first item of each tuple is also a tuple containing the names of the
directories leading to and including the python filename relative to the
package. The second item in the tuple is the bytes content of the file.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.get_stage_ref">
<span class="sig-name descname"><span class="pre">get_stage_ref</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="Permalink to this definition"></a></dt>
<dd><p>Returns a <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> instance that refers to the
original stage. See <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for details.</p>
<p>One of <code class="docutils literal notranslate"><span class="pre">name</span></code> or <code class="docutils literal notranslate"><span class="pre">stage</span></code> must be specified. The stage being
referenced by <code class="docutils literal notranslate"><span class="pre">stage</span></code> should have been added to this instance,
although it is not explicitly enforced currently.</p>
<p>If used, <code class="xref py py-meth docutils literal notranslate"><span class="pre">return_stae_ref()</span></code> must be called when the reference
is not used anymore.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The name of the stage to lookup in <a class="reference internal" href="#ceed.stage.StageFactoryBase.stage_names" title="ceed.stage.StageFactoryBase.stage_names"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stage_names</span></code></a>.</p></li>
<li><p><strong>stage</strong> – Or the actual stage to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> to the original stage.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.return_stage_ref">
<span class="sig-name descname"><span class="pre">return_stage_ref</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_ref</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.return_stage_ref" title="Permalink to this definition"></a></dt>
<dd><p>Releases the stage ref created by <a class="reference internal" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="ceed.stage.StageFactoryBase.get_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_stage_ref()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>stage_ref</strong> – Instance returned by <a class="reference internal" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="ceed.stage.StageFactoryBase.get_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_stage_ref()</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.StageType" title="ceed.stage.StageType"><span class="pre">ceed.stage.StageType</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.StageFactoryBase.register" title="Permalink to this definition"></a></dt>
<dd><p>Registers the class and adds it to <a class="reference internal" href="#ceed.stage.StageFactoryBase.stages_cls" title="ceed.stage.StageFactoryBase.stages_cls"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages_cls</span></code></a>. It also
creates an instance (unless <code class="docutils literal notranslate"><span class="pre">instance</span></code> is provided, in which case
that is used) of the class that is added to <a class="reference internal" href="#ceed.stage.StageFactoryBase.stage_names" title="ceed.stage.StageFactoryBase.stage_names"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stage_names</span></code></a> and
<a class="reference internal" href="#ceed.stage.StageFactoryBase.stages_inst_default" title="ceed.stage.StageFactoryBase.stages_inst_default"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages_inst_default</span></code></a>.</p>
<p>See <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>cls</cite>: subclass of <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a></dt><dd><p>The class to register.</p>
</dd>
<dt><cite>instance</cite>: instance of <cite>cls</cite></dt><dd><p>The instance of <cite>cls</cite> to use. If None, a default
class instance, using the default <a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a> is
stored. Defaults to None.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.add_plugin_source">
<span class="sig-name descname"><span class="pre">add_plugin_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.StageFactoryBase.add_plugin_source" title="Permalink to this definition"></a></dt>
<dd><p>Adds the package contents to <a class="reference internal" href="#ceed.stage.StageFactoryBase.plugin_sources" title="ceed.stage.StageFactoryBase.plugin_sources"><code class="xref py py-attr docutils literal notranslate"><span class="pre">plugin_sources</span></code></a> if it hasn’t
already been added. Otherwise raises an error.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.StageType" title="ceed.stage.StageType"><span class="pre">ceed.stage.StageType</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.get" title="Permalink to this definition"></a></dt>
<dd><p>Returns the class with name <code class="docutils literal notranslate"><span class="pre">name</span></code> that was registered with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a>.</p>
<p>See <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>name</cite>: str</dt><dd><p>The name of the class (e.g. <code class="docutils literal notranslate"><span class="pre">'CosStage'</span></code>).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The class if found, otherwise None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.get_names">
<span class="sig-name descname"><span class="pre">get_names</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.get_names" title="Permalink to this definition"></a></dt>
<dd><p>Returns the class names of all classes registered with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.get_classes">
<span class="sig-name descname"><span class="pre">get_classes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.StageType" title="ceed.stage.StageType"><span class="pre">ceed.stage.StageType</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.get_classes" title="Permalink to this definition"></a></dt>
<dd><p>Returns the classes registered with <a class="reference internal" href="#ceed.stage.StageFactoryBase.register" title="ceed.stage.StageFactoryBase.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.make_stage">
<span class="sig-name descname"><span class="pre">make_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clone</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func_name_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_name_to_shape_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.make_stage" title="Permalink to this definition"></a></dt>
<dd><p>Instantiates the stage from the state and returns it.</p>
<p>This method must be used to instantiate a stage from state.
See <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for details and an example.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – The state dict representing the stage as returned by
<code class="xref py py-meth docutils literal notranslate"><span class="pre">FuncBase.get_state()</span></code>.</p></li>
<li><p><strong>instance</strong> – If None, a stage instance will be created and state
will applied to it. Otherwise, it is applied to the given instance,
which must be of the correct class.</p></li>
<li><p><strong>clone</strong> – See <a class="reference internal" href="#ceed.stage.CeedStage.apply_state" title="ceed.stage.CeedStage.apply_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.apply_state()</span></code></a>.</p></li>
<li><p><strong>func_name_map</strong> – See <a class="reference internal" href="#ceed.stage.CeedStage.apply_state" title="ceed.stage.CeedStage.apply_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.apply_state()</span></code></a>.</p></li>
<li><p><strong>old_name_to_shape_map</strong> – See <a class="reference internal" href="#ceed.stage.CeedStage.apply_state" title="ceed.stage.CeedStage.apply_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.apply_state()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The stage instance created or used.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.add_stage">
<span class="sig-name descname"><span class="pre">add_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_last_experiment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.add_stage" title="Permalink to this definition"></a></dt>
<dd><p>Adds the <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> to the stage factory (<a class="reference internal" href="#ceed.stage.StageFactoryBase.stages" title="ceed.stage.StageFactoryBase.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>)
and makes it available in the GUI.</p>
<p>See <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for details.</p>
<p>Remember to check <code class="xref py py-meth docutils literal notranslate"><span class="pre">can_other_stage_be_added()</span></code> before adding
if there’s potential for it to return False.</p>
<p>If the <a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a> already exists in <a class="reference internal" href="#ceed.stage.StageFactoryBase.stages" title="ceed.stage.StageFactoryBase.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>,
<a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a> will be set to a unique name based on its
original name. Once added until removed, anytime the stage’s
<a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a> changes, if it clashes with an existing
stage’s name, it is automatically renamed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage</strong> – The <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> to add.</p></li>
<li><p><strong>allow_last_experiment</strong> – Whether to allow the stage to have the
same name is <a class="reference internal" href="#ceed.stage.last_experiment_stage_name" title="ceed.stage.last_experiment_stage_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ceed.stage.last_experiment_stage_name</span></code></a>. If
False and a stage with that name is added, it is renamed.
Otherwise, it’s original name is kept.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.remove_stage">
<span class="sig-name descname"><span class="pre">remove_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.remove_stage" title="Permalink to this definition"></a></dt>
<dd><p>Removes a stage previously added with <a class="reference internal" href="#ceed.stage.StageFactoryBase.add_stage" title="ceed.stage.StageFactoryBase.add_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_stage()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>stage</cite>: <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a></dt><dd><p>The stage to remove.</p>
</dd>
<dt><cite>force</cite>: bool</dt><dd><p>If True, it’ll remove the stage even if there are references
to it created by <a class="reference internal" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="ceed.stage.StageFactoryBase.get_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_stage_ref()</span></code></a>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether the stage was removed successfully. E.g. if
force is False and it has a ref, it won’t be removed.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.clear_stages">
<span class="sig-name descname"><span class="pre">clear_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.clear_stages" title="Permalink to this definition"></a></dt>
<dd><p>Removes all the stages registered with <a class="reference internal" href="#ceed.stage.StageFactoryBase.add_stage" title="ceed.stage.StageFactoryBase.add_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_stage()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>force</cite>: bool</dt><dd><p>If True, it’ll remove all stages even if there are
references to them created by <a class="reference internal" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="ceed.stage.StageFactoryBase.get_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_stage_ref()</span></code></a>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.find_shape_in_all_stages">
<span class="sig-name descname"><span class="pre">find_shape_in_all_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_shape_callback</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.find_shape_in_all_stages" title="Permalink to this definition"></a></dt>
<dd><p>Searches for the <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a> instance in all the
known stages and calls <code class="docutils literal notranslate"><span class="pre">process_shape_callback</span></code> on each found.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>_</cite>: anything</dt><dd><p>This parameter is ignored and can be anything.</p>
</dd>
<dt><cite>shape</cite>: <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a></dt><dd><p>The shape to search in all stages.</p>
</dd>
<dt><cite>process_shape_callback</cite>: callback function</dt><dd><p>It is called with two parameters; the <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a>
and <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a> instance for each found.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.save_stages">
<span class="sig-name descname"><span class="pre">save_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.save_stages" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dict representation of all the stages added with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_stage" title="ceed.stage.StageFactoryBase.add_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_stage()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>use_cache</strong> – If True, it’ll get the state using the cache from
previous times the state was read and cached, if the cache exists.</p>
</dd>
</dl>
<p>It is a list of dicts where each item is the
<a class="reference internal" href="#ceed.stage.CeedStage.get_state" title="ceed.stage.CeedStage.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.get_state()</span></code></a> of the corresponding stage in
<a class="reference internal" href="#ceed.stage.StageFactoryBase.stages" title="ceed.stage.StageFactoryBase.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.recover_stages">
<span class="sig-name descname"><span class="pre">recover_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func_name_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_name_to_shape_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.recover_stages" title="Permalink to this definition"></a></dt>
<dd><p>Takes a list of stages states such as returned by
<a class="reference internal" href="#ceed.stage.StageFactoryBase.save_stages" title="ceed.stage.StageFactoryBase.save_stages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_stages()</span></code></a> and instantiates the stages represented by
the states and adds (<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_stage" title="ceed.stage.StageFactoryBase.add_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_stage()</span></code></a>) the stages to the factory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage_states</strong> – List of stages state.</p></li>
<li><p><strong>func_name_map</strong> – See <a class="reference internal" href="#ceed.stage.CeedStage.apply_state" title="ceed.stage.CeedStage.apply_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.apply_state()</span></code></a>.</p></li>
<li><p><strong>old_name_to_shape_map</strong> – See <a class="reference internal" href="#ceed.stage.CeedStage.apply_state" title="ceed.stage.CeedStage.apply_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.apply_state()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple <code class="docutils literal notranslate"><span class="pre">stages,</span> <span class="pre">name_map</span></code>, <code class="docutils literal notranslate"><span class="pre">stages</span></code> is the list of
stages, <code class="docutils literal notranslate"><span class="pre">name_map</span></code> is a map from the original stage’s name
to the new name given to the stage (in case a stage with that
name already existed).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.tick_stage">
<span class="sig-name descname"><span class="pre">tick_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frame_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">fractions.Fraction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_compute</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.tick_stage" title="Permalink to this definition"></a></dt>
<dd><p>A generator which starts a <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> and can be time-ticked
to generate the shape intensity values for each time point in the
experiment.</p>
<p>A <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> represents a collection of shapes with functions
applied to them. Each of these shapes has a defined intensity for
every time point. This generator walks through time computing the
intensity for each shape for every time point and yielding it.</p>
<p>See <a class="reference internal" href="#ceed.stage.StageFactoryBase.get_all_shape_values" title="ceed.stage.StageFactoryBase.get_all_shape_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_all_shape_values()</span></code></a> for example usage. Ceed GUI uses this
to generate the shape intensity values shown during an experiment.</p>
<p>See the example in <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stage</span></code></a> showing how to run a stage with
this method.</p>
<dl class="field-list">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>t_start</cite>: a number</dt><dd><p>The global time at which the stage starts.</p>
</dd>
<dt><cite>frame_rate</cite>: fraction</dt><dd><p>The frame rate to sample at, as a fraction.</p>
</dd>
<dt><cite>stage_name</cite>: str</dt><dd><p>The <a class="reference internal" href="#ceed.stage.CeedStage.name" title="ceed.stage.CeedStage.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.name</span></code></a> of the stage to start.</p>
</dd>
<dt><cite>stage</cite>: str</dt><dd><p>The <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> to start.</p>
</dd>
<dt><cite>pre_compute</cite>: bool</dt><dd><p>Whether to pre-compute the stages, for those stages that support
it.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>A list of the intensity values for each shape.</p>
<p>Each item in the list is a 2-tuple of <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">values)</span></code>. <code class="docutils literal notranslate"><span class="pre">name</span></code>
is the <code class="xref py py-attr docutils literal notranslate"><span class="pre">kivy_garden.painter.PaintShape.name</span></code> of the shape
and is listed only once in the list.
<code class="docutils literal notranslate"><span class="pre">values</span></code> is a list of color values and each item in that list is
a 4-tuple of <code class="docutils literal notranslate"><span class="pre">(r,</span> <span class="pre">g,</span> <span class="pre">b,</span> <span class="pre">a)</span></code>. Any of these values can be None, in
which case that color remains the same (see
<a class="reference internal" href="#ceed.stage.StageFactoryBase.set_shape_gl_color_values" title="ceed.stage.StageFactoryBase.set_shape_gl_color_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_shape_gl_color_values()</span></code></a>). This way a shape can be
updated from multiple sub-stages, where only e.g. the <code class="docutils literal notranslate"><span class="pre">r</span></code> value
is changed.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>StageDoneException</cite>:</dt><dd><p>When done with the stage (time is out of bounds). The time
at which this is raised was not used by the stage so there’s
no shape values for that last time point.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas">
<span class="sig-name descname"><span class="pre">add_shapes_gl_to_canvas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">canvas</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html#kivy.graphics.instructions.Canvas" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.instructions.Canvas</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Container</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.context_instructions.html#kivy.graphics.context_instructions.Color" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.context_instructions.Color</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas" title="Permalink to this definition"></a></dt>
<dd><p>Adds all the kivy OpenGL instructions required to display the
intensity-varying shapes to the kivy canvas and returns the color
classes that control the color of each shape.</p>
<p>This is called by Ceed when it creates a new experiment to get all the
graphics for the shapes that it will control during the experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>canvas</cite>: Kivy canvas instance</dt><dd><p>The canvas to which the gl instructions are added. It add e.g.
the polygon and its color.</p>
</dd>
<dt><cite>name</cite>: str</dt><dd><p>The name to associate with these OpenGL instructions.
The name is used later to remove the instructions as it allows
to clear all the instructions with that name.</p>
</dd>
<dt><cite>quad</cite>: int or None</dt><dd><p>When in quad mode, we add the instructions 4 times, one for
each quad (top-left, top-right, bottom-left, bottom-right) so
it is called 4 times sequentially.
This counts up from 0-3 in that case. Otherwise, it’s None.
From a user POV it should not matter whether we’re in quad mode
because Ceed handles scaling and placing the graphics in the
right area.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dict whose keys is the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">kivy_garden.painter.PaintShape.name</span></code> of
the <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a> and whose value is the Kivy
<code class="docutils literal notranslate"><span class="pre">Color</span></code> instruction instance that controls the color of the
shape.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.set_shape_gl_color_values">
<span class="sig-name descname"><span class="pre">set_shape_gl_color_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape_views</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.context_instructions.html#kivy.graphics.context_instructions.Color" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.context_instructions.Color</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape_values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grayscale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.set_shape_gl_color_values" title="Permalink to this definition"></a></dt>
<dd><p>Takes the dict of the Color instances that control the color of
each shape as well as the list of the color values for the current time
point for each shape and sets the shape’s color to those values.</p>
<p>This is called by Ceed for every time step to set the current shape
color values. In QUAD4X it’s called 4 times per frame, in QUAD121X it’s
called 12 times per frame.</p>
<p>The shape color values is a list of 4-tuples, each a <code class="docutils literal notranslate"><span class="pre">r,</span> <span class="pre">g,</span> <span class="pre">b,</span> <span class="pre">a</span></code>
value. In each tuple, any of them can be None, in which case that color
channel is skipped for that tuple. The list is flattened and the last
value for each channel across all tuples is used (after being forced to
the <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code> range). If any are None across all tuples, it’s left
unchanged and not set. If all r, g, b, and a is None, that shape
becomes transparent.</p>
<dl class="field-list">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl>
<dt><cite>shape_views</cite>: dict</dt><dd><p>The dict of shape names and shapes colors as returned by
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_shapes_gl_to_canvas()</span></code></a>.</p>
<p>If it is None, the color will not be updated but the return
result will be identical to when not None.</p>
</dd>
<dt><cite>shape_values</cite>: list</dt><dd><p>The list of color intensity values to use for each shape as
yielded by <a class="reference internal" href="#ceed.stage.StageFactoryBase.tick_stage" title="ceed.stage.StageFactoryBase.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tick_stage()</span></code></a>.</p>
</dd>
<dt><cite>quad</cite>: int or None</dt><dd><p>When in quad mode, we added the instructions 4 times, one for
each quad. This indicates which quad is being updated, counting
up from 0-3 in that case. Otherwise, it’s None.</p>
</dd>
<dt><cite>grayscale</cite>: str</dt><dd><p>The colors to operate on. Can be any subset of the string
‘rgb’. Specifically, although we get intensity values for some
subset of r, g, b values for each stage from the stage settings,
this computes the average intensity for the active RGB channels
selected in the stage and assigns the mean to all of the colors
listed in <code class="docutils literal notranslate"><span class="pre">grayscale</span></code>.</p>
<p>E.g. if a stage selects the r and g colors in its config, and
<code class="docutils literal notranslate"><span class="pre">grayscale</span></code> is <code class="docutils literal notranslate"><span class="pre">&quot;gb&quot;</span></code>, then both the g and b channels are
set to the mean of the r and g values provided by the stage for
this timestep (b is excluded since the stage
provides no value for it). The b channel is not set so it’s
left unchanged (i.e. it’ll keep the last value).</p>
<p>This is how we turn the color into a gray-scale value when e.g.
in <code class="docutils literal notranslate"><span class="pre">QUAD12X</span></code> mode. Specifically, in that mode, this method is
called 12 times, 4 for the 4 quads, and 3 for the r, g, and b
color channel for each quad. It gets called 4 times for the red
channel with <code class="docutils literal notranslate"><span class="pre">grayscale</span></code> set to <code class="docutils literal notranslate"><span class="pre">'r'</span></code>, followed by 4 times
for the green channel with <code class="docutils literal notranslate"><span class="pre">grayscale</span></code> set to <code class="docutils literal notranslate"><span class="pre">'g'</span></code>,
followed by 4 times for the blue channel with <code class="docutils literal notranslate"><span class="pre">grayscale</span></code> set
to <code class="docutils literal notranslate"><span class="pre">'b'</span></code>. This sets the value for 12 frames.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of the colors each shape was set to. Each item in the list
is <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">r,</span> <span class="pre">g,</span> <span class="pre">b,</span> <span class="pre">a)</span></code>, where <code class="docutils literal notranslate"><span class="pre">name</span></code> is the shape’s name and
<code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">g</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span></code> is the color value it was set to.
Each <code class="docutils literal notranslate"><span class="pre">name</span></code> occurs at most once in the list.</p>
</dd>
</dl>
<p>E.g. from the worked example in <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stage</span></code></a>, by default
we called <a class="reference internal" href="#ceed.stage.StageFactoryBase.set_shape_gl_color_values" title="ceed.stage.StageFactoryBase.set_shape_gl_color_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_shape_gl_color_values()</span></code></a> with no grayscale parameter
value, which printed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0, 0, 0, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>  <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.165, 0, 0.165, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.33, 0, 0.33, 1)]&quot;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If we provide <code class="docutils literal notranslate"><span class="pre">&quot;r&quot;</span></code> for grayscale, it prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.0, 0.0, 0.0, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="n">s</span><span class="p">,</span>  <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.165, 0.165, 0.165, 1)]&quot;</span>
<span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="n">s</span><span class="p">,</span>    <span class="n">intensity</span><span class="o">=</span><span class="s2">&quot;[(&#39;Shape&#39;, 0.33, 0.33, 0.33, 1)]&quot;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>That is the stage only sets red and blue, so it averages those two
values, which happen to be the same because there’s only one stage
setting the color value for both red/blue channels. This mean value
is assigned to r, g, and b in the result. However, if <code class="docutils literal notranslate"><span class="pre">shape_views</span></code>
was provided to the function, only the red channel’s color would be
set to this value because grayscale was <code class="docutils literal notranslate"><span class="pre">&quot;r&quot;</span></code>. If it was <code class="docutils literal notranslate"><span class="pre">&quot;rg&quot;</span></code>,
the printed value would be the same, but only red and green of the Color
graphics instructions would be set to the mean value and the others
(green/blue or blue, respectively) remain unchanged.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas">
<span class="sig-name descname"><span class="pre">remove_shapes_gl_from_canvas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">canvas</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html#kivy.graphics.instructions.Canvas" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.instructions.Canvas</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas" title="Permalink to this definition"></a></dt>
<dd><p>Removes all the shape and color instructions that was added with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_shapes_gl_to_canvas()</span></code></a>.</p>
<p>This is called by Ceed after an experiment and it removes all the
instructions added with this group name.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>canvas</cite>: Kivy canvas instance</dt><dd><p>The canvas to which the gl instructions were added.</p>
</dd>
<dt><cite>name</cite>: str</dt><dd><p>The name used when adding the instructions with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_shapes_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_shapes_gl_to_canvas()</span></code></a>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.get_all_shape_values">
<span class="sig-name descname"><span class="pre">get_all_shape_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">fractions.Fraction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_compute</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.get_all_shape_values" title="Permalink to this definition"></a></dt>
<dd><p>Uses <a class="reference internal" href="#ceed.stage.StageFactoryBase.tick_stage" title="ceed.stage.StageFactoryBase.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tick_stage()</span></code></a> for every shape in the stage <code class="docutils literal notranslate"><span class="pre">stage_name</span></code>
or given <code class="docutils literal notranslate"><span class="pre">stage</span></code>, it samples all the shape intensity values at the
given frame rate for the full stage duration and returns a list of
intensity values for each shape corresponding to each time point.</p>
<p>frame_rate is not <code class="xref py py-attr docutils literal notranslate"><span class="pre">frame_rate</span></code> (although it can be) bur rather
the rate at which we sample the functions.</p>
<dl class="simple">
<dt>TODO: skip functions that are infinite duration. Add option to indicate</dt><dd><p>stage is also infinite. Currently it would just hang for infinite
stage.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas">
<span class="sig-name descname"><span class="pre">add_manual_gl_to_canvas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">screen_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">screen_height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">canvas</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html#kivy.graphics.instructions.Canvas" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.instructions.Canvas</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quad_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="Permalink to this definition"></a></dt>
<dd><p>Adds all the kivy OpenGL instructions that a stage may manually
set. It internally calls <a class="reference internal" href="#ceed.stage.CeedStage.add_gl_to_canvas" title="ceed.stage.CeedStage.add_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_gl_to_canvas()</span></code></a> for the
root stage and all its substages.</p>
<p>This is called by Ceed when it creates a new experiment to get all the
graphics for the stage used during an experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>screen_width</strong> – The width of the projector in pixels.</p></li>
<li><p><strong>screen_height</strong> – The height of the projector in pixels.</p></li>
<li><p><strong>stage</strong> – The root <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> that will be run.</p></li>
<li><p><strong>canvas</strong> – The Kivy canvas instance to which the gl instructions
must be added.</p></li>
<li><p><strong>name</strong> – The name to associate with these OpenGL instructions.
The name is used later to remove the instructions in
<a class="reference internal" href="#ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas" title="ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_shapes_gl_from_canvas()</span></code></a> as it allows to clear all the
instructions with that name.</p></li>
<li><p><strong>quad_mode</strong> – Whether we’re in quad mode. This is the specific quad
mode used. It can be one of ‘RGB’ (normal mode), ‘QUAD4X’, or
‘QUAD12X’.</p></li>
<li><p><strong>quad</strong> – <p>When in quad mode, we have to add the instructions 4 times,
one for each quad (top-left, top-right, bottom-left, bottom-right)
so it is called 4 times sequentially. This counts up from 0-3 in
that case. Otherwise, it’s None.</p>
<p>From a user POV it should not matter whether we’re in quad mode
because Ceed handles scaling and placing the graphics in the
right area. So the user must always create their graphics at full
screen size and relative to bottom left corner. Ceed will
automatically scale and translate them to the appropriate quad.</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The list of stages who added graphics instructions (their
<a class="reference internal" href="#ceed.stage.CeedStage.add_gl_to_canvas" title="ceed.stage.CeedStage.add_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_gl_to_canvas()</span></code></a> returned True).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.set_manual_gl_colors">
<span class="sig-name descname"><span class="pre">set_manual_gl_colors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grayscale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.set_manual_gl_colors" title="Permalink to this definition"></a></dt>
<dd><p>Calls <a class="reference internal" href="#ceed.stage.CeedStage.set_gl_colors" title="ceed.stage.CeedStage.set_gl_colors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_gl_colors()</span></code></a> for all the stages with manual
graphics.</p>
<p>Called by Ceed for every time step to allow the stages to update
their manually added gl instructions (in
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>) for this frame. In QUAD4X it’s called
4 times per frame, in QUAD121X it’s called 12 times per frame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stages</strong> – The list of stages returned by
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>.</p></li>
<li><p><strong>quad</strong> – Same as in <a class="reference internal" href="#ceed.stage.StageFactoryBase.set_shape_gl_color_values" title="ceed.stage.StageFactoryBase.set_shape_gl_color_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_shape_gl_color_values()</span></code></a>.</p></li>
<li><p><strong>grayscale</strong> – Same as in <a class="reference internal" href="#ceed.stage.StageFactoryBase.set_shape_gl_color_values" title="ceed.stage.StageFactoryBase.set_shape_gl_color_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_shape_gl_color_values()</span></code></a>.</p></li>
<li><p><strong>clear</strong> – Unlike for the shape graphics that Ceed controls directly
Ceed does not control the manual graphics. If a stage ends in the
middle of a frame in quad mode, then the rest of the graphics or
color channels for that frame must be cleared to black. Therefore,
This will be called for those quads/channels with this parameter
True and you must clear it.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageFactoryBase.remove_manual_gl_from_canvas">
<span class="sig-name descname"><span class="pre">remove_manual_gl_from_canvas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">canvas</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html#kivy.graphics.instructions.Canvas" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.instructions.Canvas</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageFactoryBase.remove_manual_gl_from_canvas" title="Permalink to this definition"></a></dt>
<dd><p>Removes all the gl instructions that was added with
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>. It internally calls
<a class="reference internal" href="#ceed.stage.CeedStage.remove_gl_from_canvas" title="ceed.stage.CeedStage.remove_gl_from_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_gl_from_canvas()</span></code></a> for the root stage and all its
substages.</p>
<p>This is called by Ceed after an experiment and it should remove all the
instructions added. Instructions added with this <code class="docutils literal notranslate"><span class="pre">name</span></code> will be
automatically removed by <a class="reference internal" href="#ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas" title="ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_shapes_gl_from_canvas()</span></code></a> so they
don’t have to be removed manually.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage</strong> – The root <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> that was run.</p></li>
<li><p><strong>canvas</strong> – The Kivy canvas instance to which the gl instructions
was added.</p></li>
<li><p><strong>name</strong> – The name associated with these OpenGL instructions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ceed.stage.CeedStage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">CeedStage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><span class="pre">ceed.stage.StageFactoryBase</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../function/function.html#ceed.function.FunctionFactoryBase" title="ceed.function.FunctionFactoryBase"><span class="pre">ceed.function.FunctionFactoryBase</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><span class="pre">ceed.shape.CeedPaintCanvasBehavior</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.CeedStage" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">kivy._event.EventDispatcher</span></code>, <a class="reference internal" href="../utils.html#ceed.utils.CeedWithID" title="ceed.utils.CeedWithID"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.utils.CeedWithID</span></code></a></p>
<p>The stage that controls a time period of an experiment.</p>
<p>See <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Events</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>on_changed</cite>:</dt><dd><p>Triggered whenever a stage’s configuration option changes or
if one of the functions or shapes of the stage is added/removed.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.name">
<span class="sig-name descname"><span class="pre">name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#ceed.stage.CeedStage.name" title="Permalink to this definition"></a></dt>
<dd><p>The name of this stage.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.order">
<span class="sig-name descname"><span class="pre">order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#ceed.stage.CeedStage.order" title="Permalink to this definition"></a></dt>
<dd><p>The order in which the sub-stages, <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>, are evaluated.
Can be one of <code class="docutils literal notranslate"><span class="pre">'serial'</span></code> (one after the other), <code class="docutils literal notranslate"><span class="pre">'parallel'</span></code> (all in
parallel).</p>
<p>See <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> description for details.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.complete_on">
<span class="sig-name descname"><span class="pre">complete_on</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#ceed.stage.CeedStage.complete_on" title="Permalink to this definition"></a></dt>
<dd><p>When to consider the stage’s children stages to be complete if we contain
sub-stages - <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>. Can be one of <code class="docutils literal notranslate"><span class="pre">'all'</span></code>, <code class="docutils literal notranslate"><span class="pre">'any'</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">'any'</span></code>, this stage is done when <strong>any</strong> of the children stages is
done, and when all of this stage’s functions are done. If <code class="docutils literal notranslate"><span class="pre">'all'</span></code>, this
stage is done when <strong>all</strong> children stages are done, and when all of this
stage’s functions are done.</p>
<p>See <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> description for details.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.disable_pre_compute">
<span class="sig-name descname"><span class="pre">disable_pre_compute</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.disable_pre_compute" title="Permalink to this definition"></a></dt>
<dd><p>Whether to disable pre-computing for this stage.</p>
<p>When pre-computing, either the stage is completely pre-computed from its
functions and all sub-stages and then the stage’s intensity values for all
time-points becomes essentially a flat list stored in
<a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a>. Or, if e.g. some of the sub-stages or functions
cannot be pre-computed, then only the stage’s functions (or those among the
functions that can be pre-computed) are pre-computed and all are stored in
<a class="reference internal" href="#ceed.stage.CeedStage.runtime_functions" title="ceed.stage.CeedStage.runtime_functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_functions</span></code></a>.</p>
<p>When <a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">disable_pre_compute</span></code></a> is True, neither is pre-computed, even if
the overall
<a class="reference internal" href="../view/controller.html#ceed.view.controller.ViewControllerBase.pre_compute_stages" title="ceed.view.controller.ViewControllerBase.pre_compute_stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pre_compute_stages</span></code></a> is True.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.loop">
<span class="sig-name descname"><span class="pre">loop</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#ceed.stage.CeedStage.loop" title="Permalink to this definition"></a></dt>
<dd><p>The number of loop iterations the stage should do.</p>
<p>If more than one, the stage will go through all its <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> and
<a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> <a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop</span></code></a> times.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.parent_stage">
<span class="sig-name descname"><span class="pre">parent_stage</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></em><a class="headerlink" href="#ceed.stage.CeedStage.parent_stage" title="Permalink to this definition"></a></dt>
<dd><p>The parent stage when this stage is a sub-stage of another.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.has_ref">
<span class="sig-name descname"><span class="pre">has_ref</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.has_ref" title="Permalink to this definition"></a></dt>
<dd><p>Whether there’s a CeedStageRef pointing to this stage.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.color_r">
<span class="sig-name descname"><span class="pre">color_r</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.color_r" title="Permalink to this definition"></a></dt>
<dd><p>Whether the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a> red channel should be set to the
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> value or if it should remain at zero intensity (False).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.color_g">
<span class="sig-name descname"><span class="pre">color_g</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.color_g" title="Permalink to this definition"></a></dt>
<dd><p>Whether the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a> green channel should be set to the
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> value or if it should remain at zero intensity (False).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.color_b">
<span class="sig-name descname"><span class="pre">color_b</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.color_b" title="Permalink to this definition"></a></dt>
<dd><p>Whether the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a> blue channel should be set to the
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> value or if it should remain at zero intensity (False).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.color_a">
<span class="sig-name descname"><span class="pre">color_a</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.color_a" title="Permalink to this definition"></a></dt>
<dd><p>Whether the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a> alpha channel should be set. Currently
this is ignored.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.randomize_child_order">
<span class="sig-name descname"><span class="pre">randomize_child_order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.randomize_child_order" title="Permalink to this definition"></a></dt>
<dd><p>Whether the sub-stages order should be randomly re-shuffled before each
experiment.</p>
<p>If True, <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> order stays the same, but the stage executes them
in random order. The order is pre-sampled before the stage is executed and
the given order is then used during the stage.</p>
<p>The order is stored in <a class="reference internal" href="#ceed.stage.CeedStage.shuffled_order" title="ceed.stage.CeedStage.shuffled_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffled_order</span></code></a>.</p>
<p>See also <a class="reference internal" href="#ceed.stage.CeedStage.randomize_order_each_loop" title="ceed.stage.CeedStage.randomize_order_each_loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">randomize_order_each_loop</span></code></a>, <a class="reference internal" href="#ceed.stage.CeedStage.lock_after_forked" title="ceed.stage.CeedStage.lock_after_forked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lock_after_forked</span></code></a>,
<a class="reference internal" href="#ceed.stage.CeedStage.loop_count" title="ceed.stage.CeedStage.loop_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_count</span></code></a>, and <a class="reference internal" href="#ceed.stage.CeedStage.loop_tree_count" title="ceed.stage.CeedStage.loop_tree_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_tree_count</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.randomize_order_each_loop">
<span class="sig-name descname"><span class="pre">randomize_order_each_loop</span></span><a class="headerlink" href="#ceed.stage.CeedStage.randomize_order_each_loop" title="Permalink to this definition"></a></dt>
<dd><p>When <a class="reference internal" href="#ceed.stage.CeedStage.randomize_child_order" title="ceed.stage.CeedStage.randomize_child_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">randomize_child_order</span></code></a> is True, whether the child order
should be re-shuffled for each loop iteration including loops of parent
and parent of parents etc. (True) or whether we shuffle
once before each experiment and use that order for all loop iterations.</p>
<p>See also <a class="reference internal" href="#ceed.stage.CeedStage.randomize_child_order" title="ceed.stage.CeedStage.randomize_child_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">randomize_child_order</span></code></a>, <a class="reference internal" href="#ceed.stage.CeedStage.lock_after_forked" title="ceed.stage.CeedStage.lock_after_forked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lock_after_forked</span></code></a>,
<a class="reference internal" href="#ceed.stage.CeedStage.loop_count" title="ceed.stage.CeedStage.loop_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_count</span></code></a>, and <a class="reference internal" href="#ceed.stage.CeedStage.loop_tree_count" title="ceed.stage.CeedStage.loop_tree_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_tree_count</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.lock_after_forked">
<span class="sig-name descname"><span class="pre">lock_after_forked</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.CeedStage.lock_after_forked" title="Permalink to this definition"></a></dt>
<dd><p>Stages can reference other stages. After the reference stages
are expanded and copied before running the stage as an experiment, if
<a class="reference internal" href="#ceed.stage.CeedStage.lock_after_forked" title="ceed.stage.CeedStage.lock_after_forked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lock_after_forked</span></code></a> is False then <a class="reference internal" href="#ceed.stage.CeedStage.shuffled_order" title="ceed.stage.CeedStage.shuffled_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffled_order</span></code></a> is
re-sampled again for each copied stage. If it’s True, then it is not
re-sampled again and all the stages referencing the original stage will
share the same randomized re-ordering as the referenced stage.</p>
<p>See also <a class="reference internal" href="#ceed.stage.CeedStage.copy_and_resample" title="ceed.stage.CeedStage.copy_and_resample"><code class="xref py py-attr docutils literal notranslate"><span class="pre">copy_and_resample</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.shuffled_order">
<span class="sig-name descname"><span class="pre">shuffled_order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[]</span></em><a class="headerlink" href="#ceed.stage.CeedStage.shuffled_order" title="Permalink to this definition"></a></dt>
<dd><p>When <a class="reference internal" href="#ceed.stage.CeedStage.randomize_child_order" title="ceed.stage.CeedStage.randomize_child_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">randomize_child_order</span></code></a> is True, it is a list of the
<a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> ordering that we should use for each loop.</p>
<p>It is a list of lists, and each internal list corresponds to a single loop
iteration as indexed by <a class="reference internal" href="#ceed.stage.CeedStage.loop_tree_count" title="ceed.stage.CeedStage.loop_tree_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_tree_count</span></code></a>. If we don’t
<a class="reference internal" href="#ceed.stage.CeedStage.randomize_order_each_loop" title="ceed.stage.CeedStage.randomize_order_each_loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">randomize_order_each_loop</span></code></a>, then it contains a single list used for
all the loops, otherwise there’s one for each loop.</p>
<p>If not <a class="reference internal" href="#ceed.stage.CeedStage.randomize_child_order" title="ceed.stage.CeedStage.randomize_child_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">randomize_child_order</span></code></a>, then it’s empty and they run in
<a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> order.</p>
<p>If there are more loops than number of items in the outer list, we use the
last sub-list for the remaining loops. If not all <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> indices are
included in the internal lists, those stages are skipped.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.display">
<span class="sig-name descname"><span class="pre">display</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStage.display" title="Permalink to this definition"></a></dt>
<dd><p>A widget used by the GUI to display the stage.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.pad_stage_ticks">
<span class="sig-name descname"><span class="pre">pad_stage_ticks</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#ceed.stage.CeedStage.pad_stage_ticks" title="Permalink to this definition"></a></dt>
<dd><p>If the duration of the stage as represented by the number of clock tick
is less than <a class="reference internal" href="#ceed.stage.CeedStage.pad_stage_ticks" title="ceed.stage.CeedStage.pad_stage_ticks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pad_stage_ticks</span></code></a>, the stage will be padded to
<a class="reference internal" href="#ceed.stage.CeedStage.pad_stage_ticks" title="ceed.stage.CeedStage.pad_stage_ticks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pad_stage_ticks</span></code></a> clock cycles at the end.</p>
<p>During those cycles, the stage’s shapes will be unchanged by this stage
(i.e. if another stage is simultaneously active and set their values, that
value will be used, otherwise it’ll be transparent), except for the shapes
with <a class="reference internal" href="#ceed.stage.StageShape.keep_dark" title="ceed.stage.StageShape.keep_dark"><code class="xref py py-attr docutils literal notranslate"><span class="pre">StageShape.keep_dark</span></code></a> that will still be kept black.</p>
<p>See <a class="reference internal" href="../view/controller.html#ceed.view.controller.ViewControllerBase.pad_to_stage_handshake" title="ceed.view.controller.ViewControllerBase.pad_to_stage_handshake"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pad_to_stage_handshake</span></code></a>
for usage details.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is for internal use and is not saved with the stage state.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.t_start">
<span class="sig-name descname"><span class="pre">t_start</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#ceed.stage.CeedStage.t_start" title="Permalink to this definition"></a></dt>
<dd><p>The global time with which the stage or loop iteration was
initialized. The value is in seconds.</p>
<p>Don’t set directly, it is set in <a class="reference internal" href="#ceed.stage.CeedStage.init_stage" title="ceed.stage.CeedStage.init_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_stage()</span></code></a> and
<a class="reference internal" href="#ceed.stage.CeedStage.init_loop_iteration" title="ceed.stage.CeedStage.init_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_loop_iteration()</span></code></a>. If the stage is <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>, this
is not used after pre-computing the stage.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.t_end">
<span class="sig-name descname"><span class="pre">t_end</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#ceed.stage.CeedStage.t_end" title="Permalink to this definition"></a></dt>
<dd><p>The time at which the loop or stage ended in global timebase.</p>
<p>Set by the stage after each loop is done and is only valid once loop/stage
is done. It is used by the next stage in <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> after this stage to
know when to start, or for this stage to know when the the next loop
started. If the stage is <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>, after pre-computing the
stage it is only set to indicate when the stage ends, not for each loop.</p>
<p>If overwriting <a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate_stage()</span></code></a>, this must be set with the
last time value passed in that was <em>not</em> used, indicating the time the
stage ended (i.e. the stage spanned from the stage start time until
<a class="reference internal" href="#ceed.stage.CeedStage.t_end" title="ceed.stage.CeedStage.t_end"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t_end</span></code></a>, not including the end). The next stage in the sequence would
start from this time. Similarly, if manually setting <a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a>,
the total stage duration is included and this value is automatically set
from it in <a class="reference internal" href="#ceed.stage.CeedStage.evaluate_pre_computed_stage" title="ceed.stage.CeedStage.evaluate_pre_computed_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate_pre_computed_stage()</span></code></a>.</p>
<p>It is updated before <a class="reference internal" href="#ceed.stage.CeedStage.finalize_loop_iteration" title="ceed.stage.CeedStage.finalize_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize_loop_iteration()</span></code></a>, and
<a class="reference internal" href="#ceed.stage.CeedStage.finalize_stage" title="ceed.stage.CeedStage.finalize_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize_stage()</span></code></a> are called.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.loop_count">
<span class="sig-name descname"><span class="pre">loop_count</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#ceed.stage.CeedStage.loop_count" title="Permalink to this definition"></a></dt>
<dd><p>The current loop iteration.</p>
<p>This goes from zero (set by <a class="reference internal" href="#ceed.stage.CeedStage.init_stage" title="ceed.stage.CeedStage.init_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_stage()</span></code></a> /
<a class="reference internal" href="#ceed.stage.CeedStage.init_loop_iteration" title="ceed.stage.CeedStage.init_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_loop_iteration()</span></code></a>) to <a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop</span></code></a> - 1. The stage is done when
it is exactly <a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop</span></code></a> - 1, having looped <code class="xref py py-attr docutils literal notranslate"><span class="pre">times</span></code>.
When <a class="reference internal" href="#ceed.stage.CeedStage.finalize_loop_iteration" title="ceed.stage.CeedStage.finalize_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize_loop_iteration()</span></code></a> and
<a class="reference internal" href="#ceed.stage.CeedStage.finalize_stage" title="ceed.stage.CeedStage.finalize_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize_stage()</span></code></a> are called, it is the value for the loop
iteration that just ended.</p>
<p>If the stage is <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>, this is not used after
pre-computing the stage.</p>
<p>See also <a class="reference internal" href="#ceed.stage.CeedStage.loop_tree_count" title="ceed.stage.CeedStage.loop_tree_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_tree_count</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.loop_tree_count">
<span class="sig-name descname"><span class="pre">loop_tree_count</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#ceed.stage.CeedStage.loop_tree_count" title="Permalink to this definition"></a></dt>
<dd><p>The current iteration, starting from zero, and incremented for each loop
of the stage, including outside loops that loop over the stage.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Stage</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">root</span>
    <span class="n">loop</span><span class="p">:</span> <span class="mi">2</span>
    <span class="n">Stage</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">child</span>
        <span class="n">loop</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Then the root and child stage’s <a class="reference internal" href="#ceed.stage.CeedStage.loop_count" title="ceed.stage.CeedStage.loop_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_count</span></code></a> will be 0 - 1, and 0 - 2,
respectively, while <a class="reference internal" href="#ceed.stage.CeedStage.loop_tree_count" title="ceed.stage.CeedStage.loop_tree_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop_tree_count</span></code></a> will be 0 - 1 and 0 - 5,
respectively.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.runtime_functions">
<span class="sig-name descname"><span class="pre">runtime_functions</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[]</span></em><a class="headerlink" href="#ceed.stage.CeedStage.runtime_functions" title="Permalink to this definition"></a></dt>
<dd><p>Stores the pre-computed function values for those can be pre-computed
and the original function for the rest.</p>
<p>Similar to <a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a>, but if <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a> is False
yet <a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">disable_pre_compute</span></code></a> is also False, then we pre-compute all
the functions who are not infinite in duration (
<a class="reference internal" href="../function/function.html#ceed.function.FuncBase.duration" title="ceed.function.FuncBase.duration"><code class="xref py py-attr docutils literal notranslate"><span class="pre">duration</span></code></a> is non-negative) and store them
here interleaved with those that are infinite.</p>
<p>It is a list of 4-tuples of the same length as <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a>. Each item
is <code class="docutils literal notranslate"><span class="pre">(function,</span> <span class="pre">intensity,</span> <span class="pre">logs,</span> <span class="pre">duration)</span></code>. It is generated by
<a class="reference internal" href="#ceed.stage.CeedStage.pre_compute_functions" title="ceed.stage.CeedStage.pre_compute_functions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pre_compute_functions()</span></code></a>.</p>
<p>If the corresponding function is
pre-computable, the <code class="docutils literal notranslate"><span class="pre">function</span></code> is None and intensity, logs, and duration
is similar to <a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a> with the same constraints about each
intensity and logs value corresponds to a time point the function is sampled
and the ending time-point must be larger or equal to duration, relative to
the function start time. <code class="docutils literal notranslate"><span class="pre">logs</span></code> may be one value larger than
<code class="docutils literal notranslate"><span class="pre">intensity</span></code>, if there’s some logs to be emitted on the frame after the
last sample.</p>
<p>If the function is not pre-computable, the <code class="docutils literal notranslate"><span class="pre">function</span></code> is the original
function and <code class="docutils literal notranslate"><span class="pre">intensity</span></code>, <code class="docutils literal notranslate"><span class="pre">logs</span></code>, and <code class="docutils literal notranslate"><span class="pre">duration</span></code> are None.</p>
<p>If set manually, ensure that <a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_pre_compute()</span></code></a> is overwritten to do
nothing, otherwise it may overwrite your value. Similarly,
<a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a> must be None, otherwise that will be used instead.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.runtime_stage">
<span class="sig-name descname"><span class="pre">runtime_stage</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStage.runtime_stage" title="Permalink to this definition"></a></dt>
<dd><p>A 4-tuple of stage <code class="docutils literal notranslate"><span class="pre">(intensity,</span> <span class="pre">logs,</span> <span class="pre">count,</span> <span class="pre">duration)</span></code>.</p>
<p>If <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>, then this stage’s intensity values are
pre-computed into a list for each shape and stored here. Otherwise, if
it’s not pre-computed it is None. <code class="docutils literal notranslate"><span class="pre">intensity</span></code> is a dict whose keys
are shape names and values are a list of r, g, b, a values, one for each
time point indicating the r,g,b,a value for that shape for that time point.</p>
<p>Each time-point value corresponds exactly to the time passed to
the stage that generated the value. E.g. with a linear function, the stage
may be called with times (relative to the stage start time) such as
0 / rate, 1 / rate, … n / rate and the values correspond to the function
values at those times. Then during the experiment, as we get time values,
we instead count the number of tick stage calls and that number is the
index into the values list that we return for all the shapes.</p>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">logs</span></code> is a list of any data event logs captured during
pre-computing. These logs are replayed during the real experiment for
each corresponding frame.</p>
<p><code class="docutils literal notranslate"><span class="pre">count</span></code> is the number of frames in <code class="docutils literal notranslate"><span class="pre">intensity</span></code> and <code class="docutils literal notranslate"><span class="pre">logs</span></code>.
However, <code class="docutils literal notranslate"><span class="pre">logs</span></code> may be one value larger than <code class="docutils literal notranslate"><span class="pre">intensity</span></code> (<code class="docutils literal notranslate"><span class="pre">count</span></code>), if
there’s some logs to be emitted on the frame after the last sample.</p>
<p>After the last value in the list is used, the next time point past will
raise a <a class="reference internal" href="#ceed.stage.StageDoneException" title="ceed.stage.StageDoneException"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageDoneException</span></code></a> indicating the stage is done and the
time value will have to be larger or equal to <a class="reference internal" href="#ceed.stage.CeedStage.t_end" title="ceed.stage.CeedStage.t_end"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t_end</span></code></a>, which is the
same saying the time relative to the stage start time must be larger or
equal to the <code class="docutils literal notranslate"><span class="pre">duration</span></code> of the tuple.</p>
<p>By default it is generated by <a class="reference internal" href="#ceed.stage.CeedStage.pre_compute_stage" title="ceed.stage.CeedStage.pre_compute_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pre_compute_stage()</span></code></a>.
If set manually by the user, the above constraints must be followed and
additionally, <a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_pre_compute()</span></code></a> should be overwritten to do
nothing, otherwise it may overwrite your value.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.can_pre_compute">
<span class="sig-name descname"><span class="pre">can_pre_compute</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#ceed.stage.CeedStage.can_pre_compute" title="Permalink to this definition"></a></dt>
<dd><p>Whether we can pre-compute the full stage.</p>
<p>It is read only and is automatically computed during
<a class="reference internal" href="#ceed.stage.CeedStage.init_stage_tree" title="ceed.stage.CeedStage.init_stage_tree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_stage_tree()</span></code></a>.</p>
<p>If True it means that all the <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> have finite duration
(i.e. non-negative), for all <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> their <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>
is True, and <a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">disable_pre_compute</span></code></a> is False.</p>
<p><a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_pre_compute()</span></code></a> does the pre-computation. If
<a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a> is True, then it precomputes the stage’s intensity
values for all time-points that the stage is active from its
functions and all sub-stages and then essentially stores it as a flat list
in <a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a>.</p>
<p>If it is False, then if <a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">disable_pre_compute</span></code></a> is also False, then
all the functions that can be pre-computed are pre-computed, otherwise
nothing is pre-computed. In both case we still call
<a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_pre_compute()</span></code></a> on all sub-stages.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.stage_factory">
<span class="sig-name descname"><span class="pre">stage_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><span class="pre">ceed.stage.StageFactoryBase</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStage.stage_factory" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> this stage is associated with.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.function_factory">
<span class="sig-name descname"><span class="pre">function_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.FunctionFactoryBase" title="ceed.function.FunctionFactoryBase"><span class="pre">ceed.function.FunctionFactoryBase</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStage.function_factory" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="../function/function.html#ceed.function.FunctionFactoryBase" title="ceed.function.FunctionFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionFactoryBase</span></code></a> the <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a>
are associated with.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.shape_factory">
<span class="sig-name descname"><span class="pre">shape_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><span class="pre">ceed.shape.CeedPaintCanvasBehavior</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStage.shape_factory" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedPaintCanvasBehavior</span></code></a> the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a>
are associated with.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.functions">
<span class="sig-name descname"><span class="pre">functions</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.CeedFuncRef" title="ceed.function.CeedFuncRef"><span class="pre">ceed.function.CeedFuncRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[]</span></em><a class="headerlink" href="#ceed.stage.CeedStage.functions" title="Permalink to this definition"></a></dt>
<dd><p>A list of <a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.function.FuncBase</span></code></a> instances which the
stage iterates through sequentially to compute the intensity of all the
<a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a> at each time point.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.stages">
<span class="sig-name descname"><span class="pre">stages</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[]</span></em><a class="headerlink" href="#ceed.stage.CeedStage.stages" title="Permalink to this definition"></a></dt>
<dd><p>A list of <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> instances that are sub-stages of this
stage.</p>
<p>See <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> description for details.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.shapes">
<span class="sig-name descname"><span class="pre">shapes</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><span class="pre">ceed.stage.StageShape</span></a><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[]</span></em><a class="headerlink" href="#ceed.stage.CeedStage.shapes" title="Permalink to this definition"></a></dt>
<dd><p>The list of <a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageShape</span></code></a> instances that are associated
with this stage.</p>
<p>All the shapes are set to the same intensity value at
every time point according to the <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> value at that
time point.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.get_cached_state">
<span class="sig-name descname"><span class="pre">get_cached_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.get_cached_state" title="Permalink to this definition"></a></dt>
<dd><p>Like <a class="reference internal" href="#ceed.stage.CeedStage.get_state" title="ceed.stage.CeedStage.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_state()</span></code></a>, but it caches the result. And next time it
is called, if <code class="docutils literal notranslate"><span class="pre">use_cache</span></code> is True, the cached value will be returned,
unless the config changed in between. Helpful for backup so we don’t
recompute the full state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>use_cache</strong> – If True, it’ll get the state using the cache from
previous times the state was read and cached, if the cache exists.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The state dict.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.get_state">
<span class="sig-name descname"><span class="pre">get_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expand_ref</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.get_state" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dict representation of the stage so that it can be
reconstructed later with <a class="reference internal" href="#ceed.stage.CeedStage.apply_state" title="ceed.stage.CeedStage.apply_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_state()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>state</cite>: dict</dt><dd><p>A dict with the state, to which configuration items and their
values are added. If None, the default, a dict is created and
returned.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dict with all the configuration data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.apply_state">
<span class="sig-name descname"><span class="pre">apply_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clone</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func_name_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_name_to_shape_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.apply_state" title="Permalink to this definition"></a></dt>
<dd><p>Takes the state of the stage saved with <a class="reference internal" href="#ceed.stage.CeedStage.get_state" title="ceed.stage.CeedStage.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_state()</span></code></a> and
applies it to this stage. it also creates any children functions and
stages and creates the references to the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a>.</p>
<p>It is called internally and should not be used directly. Use
<a class="reference internal" href="#ceed.stage.StageFactoryBase.make_stage" title="ceed.stage.StageFactoryBase.make_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.make_stage()</span></code></a> instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – The state dict representing the stage as returned by
<a class="reference internal" href="#ceed.stage.CeedStage.get_state" title="ceed.stage.CeedStage.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_state()</span></code></a>.</p></li>
<li><p><strong>clone</strong> – If False, only user customizable properties of the
stage will be set (i.e those not listed in <code class="xref py py-attr docutils literal notranslate"><span class="pre">_clone_props</span></code>),
otherwise, all properties from state are
applied to the stage. Clone is meant to be a complete
re-instantiation of stage function.</p></li>
<li><p><strong>func_name_map</strong> – a mapping that maps old function names to
their new names, in case they were re-named when imported.</p></li>
<li><p><strong>old_name_to_shape_map</strong> – Mapping from shape names to the shapes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.copy_expand_ref">
<span class="sig-name descname"><span class="pre">copy_expand_ref</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></span><a class="headerlink" href="#ceed.stage.CeedStage.copy_expand_ref" title="Permalink to this definition"></a></dt>
<dd><p>Returns a copy of the stage. Any sub-stages, recursively, that are
ref-stages are expanded to normal stages.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.replace_ref_stage_with_source">
<span class="sig-name descname"><span class="pre">replace_ref_stage_with_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_ref</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.replace_ref_stage_with_source" title="Permalink to this definition"></a></dt>
<dd><p>Replaces the stage ref in <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> with a copy of the
referenced stage.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.replace_ref_func_with_source">
<span class="sig-name descname"><span class="pre">replace_ref_func_with_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func_ref</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../function/function.html#ceed.function.CeedFuncRef" title="ceed.function.CeedFuncRef"><span class="pre">ceed.function.CeedFuncRef</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.replace_ref_func_with_source" title="Permalink to this definition"></a></dt>
<dd><p>Replaces the func ref in <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> with a copy of the
referenced function.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.can_other_stage_be_added">
<span class="sig-name descname"><span class="pre">can_other_stage_be_added</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other_stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.can_other_stage_be_added" title="Permalink to this definition"></a></dt>
<dd><p>Checks whether the other stage may be added to us.</p>
<p>If the stage is already a child of this stage or sub-stages, it
returns False to prevent recursion loops.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.add_stage">
<span class="sig-name descname"><span class="pre">add_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">after</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.add_stage" title="Permalink to this definition"></a></dt>
<dd><p>Adds a sub-stage instance <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> to <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage</strong> – The <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> or ref to add.</p></li>
<li><p><strong>after</strong> – The <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> in <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>
after which to add this stage, if not None, the default.</p></li>
<li><p><strong>index</strong> – The index in <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>
at which to add this stage, if not None, the default.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.remove_stage">
<span class="sig-name descname"><span class="pre">remove_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.remove_stage" title="Permalink to this definition"></a></dt>
<dd><p>Removes a sub-stage instance <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> from <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.add_func">
<span class="sig-name descname"><span class="pre">add_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.CeedFuncRef" title="ceed.function.CeedFuncRef"><span class="pre">ceed.function.CeedFuncRef</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">after</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.CeedFuncRef" title="ceed.function.CeedFuncRef"><span class="pre">ceed.function.CeedFuncRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.add_func" title="Permalink to this definition"></a></dt>
<dd><p>Adds the function instance <a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.function.FuncBase</span></code></a> to
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – The <a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.function.FuncBase</span></code></a> to add.</p></li>
<li><p><strong>after</strong> – The <a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.function.FuncBase</span></code></a> in <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a>
after which to add this function, if not None, the default.</p></li>
<li><p><strong>index</strong> – The index in <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a>
at which to add this function, if not None, the default.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.remove_func">
<span class="sig-name descname"><span class="pre">remove_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.CeedFuncRef" title="ceed.function.CeedFuncRef"><span class="pre">ceed.function.CeedFuncRef</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.remove_func" title="Permalink to this definition"></a></dt>
<dd><p>Removes the function instance <a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.function.FuncBase</span></code></a> from
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.add_shape">
<span class="sig-name descname"><span class="pre">add_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShapeGroup" title="ceed.shape.CeedShapeGroup"><span class="pre">ceed.shape.CeedShapeGroup</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><span class="pre">ceed.shape.CeedShape</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><span class="pre">ceed.stage.StageShape</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.add_shape" title="Permalink to this definition"></a></dt>
<dd><p>Creates and adds a <a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageShape</span></code></a> instance wrapping the
<a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a> <code class="docutils literal notranslate"><span class="pre">shape</span></code> to the <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a>. If
the <code class="docutils literal notranslate"><span class="pre">shape</span></code> was already added it doesn’t add it again.</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><dl class="simple">
<dt><cite>shape</cite>: <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a></dt><dd><p>The shape instance to add.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The <a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageShape</span></code></a> created if the shape wasn’t already added,
otherwise None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.remove_shape">
<span class="sig-name descname"><span class="pre">remove_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><span class="pre">ceed.stage.StageShape</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.remove_shape" title="Permalink to this definition"></a></dt>
<dd><p>Removes a <a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageShape</span></code></a> that was previously added to
<a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.get_settings_display">
<span class="sig-name descname"><span class="pre">get_settings_display</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_widget</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.get_settings_display" title="Permalink to this definition"></a></dt>
<dd><p>Returns widgets that will be displayed to the user in the stage
settings.</p>
<p>These widgets can be used to allow users to further configure custom
stages. This is called by the Ceed GUI when the settings are first
displayed to the user.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>stage_widget</strong> – The root settings widget to which the settings
will be added as grandchildren by the caller.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>It should return a dict of the name of each setting mapped to
the widget controlling the setting. It will be displayed in two
columns: the name followed by the widget on the same row.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.get_stages">
<span class="sig-name descname"><span class="pre">get_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step_into_ref</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><span class="pre">ceed.stage.CeedStageRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.get_stages" title="Permalink to this definition"></a></dt>
<dd><p>Generator that iterates depth-first through all the stages
and children <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> and yields these stages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>step_into_ref</strong> – bool
If True, when it encounters a <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> instance
it’ll step into it and return that stage and its children.
Otherwise, it’ll just return the <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> and not
step into it.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.get_funcs">
<span class="sig-name descname"><span class="pre">get_funcs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.CeedFuncRef" title="ceed.function.CeedFuncRef"><span class="pre">ceed.function.CeedFuncRef</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.get_funcs" title="Permalink to this definition"></a></dt>
<dd><p>Generator that iterates depth-first through all the stages
and children <a class="reference internal" href="#ceed.stage.CeedStage.stages" title="ceed.stage.CeedStage.stages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stages</span></code></a> and for each stage yields each function from
<a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> as well as their children functions, recursively.</p>
<p>If it encounters a <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a> or <code class="xref py py-class docutils literal notranslate"><span class="pre">CeedFuncRef</span></code> it’ll
enter the original stage/function and yield its children.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.init_stage">
<span class="sig-name descname"><span class="pre">init_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.init_stage" title="Permalink to this definition"></a></dt>
<dd><p>Initializes the stage so it is ready to be used to get
the stage values. See also <a class="reference internal" href="#ceed.stage.CeedStage.init_stage_tree" title="ceed.stage.CeedStage.init_stage_tree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_stage_tree()</span></code></a> and
<a class="reference internal" href="#ceed.stage.CeedStage.init_loop_iteration" title="ceed.stage.CeedStage.init_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_loop_iteration()</span></code></a>. If overriding, <code class="docutils literal notranslate"><span class="pre">super</span></code> must be called.</p>
<p>If the stage is <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>, this is not used after
pre-computing the stage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>t_start</strong> – The time in seconds in global time. <a class="reference internal" href="#ceed.stage.CeedStage.t_start" title="ceed.stage.CeedStage.t_start"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t_start</span></code></a>
will be set to this value.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.init_loop_iteration">
<span class="sig-name descname"><span class="pre">init_loop_iteration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.init_loop_iteration" title="Permalink to this definition"></a></dt>
<dd><p>Initializes the stage at the beginning of each loop.</p>
<p>It’s called internally at the start of every <a class="reference internal" href="#ceed.stage.CeedStage.loop" title="ceed.stage.CeedStage.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loop</span></code></a> iteration,
<strong>except the first</strong>. See also <a class="reference internal" href="#ceed.stage.CeedStage.init_stage_tree" title="ceed.stage.CeedStage.init_stage_tree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_stage_tree()</span></code></a> and
<a class="reference internal" href="#ceed.stage.CeedStage.init_stage" title="ceed.stage.CeedStage.init_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">init_stage()</span></code></a>. If overriding, <code class="docutils literal notranslate"><span class="pre">super</span></code> must be called.</p>
<p>If the stage is <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>, this is not used after
pre-computing the stage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>t_start</strong> – The time in seconds in global time. <a class="reference internal" href="#ceed.stage.CeedStage.t_start" title="ceed.stage.CeedStage.t_start"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t_start</span></code></a>
will be set to this value.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.finalize_stage">
<span class="sig-name descname"><span class="pre">finalize_stage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.finalize_stage" title="Permalink to this definition"></a></dt>
<dd><p>Finalizes the stage at the end of all its loops, when the
stage is done. See also <a class="reference internal" href="#ceed.stage.CeedStage.finalize_loop_iteration" title="ceed.stage.CeedStage.finalize_loop_iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize_loop_iteration()</span></code></a>.
If overriding, <code class="docutils literal notranslate"><span class="pre">super</span></code> must be called.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.finalize_loop_iteration">
<span class="sig-name descname"><span class="pre">finalize_loop_iteration</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.finalize_loop_iteration" title="Permalink to this definition"></a></dt>
<dd><p>Finalizes the stage at the end of each loop, including the first
and last. See also <a class="reference internal" href="#ceed.stage.CeedStage.finalize_stage" title="ceed.stage.CeedStage.finalize_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize_stage()</span></code></a>.
If overriding, <code class="docutils literal notranslate"><span class="pre">super</span></code> must be called.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.tick_stage">
<span class="sig-name descname"><span class="pre">tick_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_end_t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.tick_stage" title="Permalink to this definition"></a></dt>
<dd><p>Similar to <a class="reference internal" href="#ceed.stage.StageFactoryBase.tick_stage" title="ceed.stage.StageFactoryBase.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.tick_stage()</span></code></a> but for this stage.
This calls internally either <a class="reference internal" href="#ceed.stage.CeedStage.evaluate_pre_computed_stage" title="ceed.stage.CeedStage.evaluate_pre_computed_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate_pre_computed_stage()</span></code></a> if the
stage was pre-computed (<a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a> is not None) or
<code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate_pre_computed_stage`evaluate_stage()</span></code> when it is not
pre-computed.</p>
<p>It is an generator that ticks through time and updates the
intensity values for the shapes associated with this stage and its
sub-stages.</p>
<p>Specifically, at every iteration, a time value is sent to the iterator
by Ceed which then updates the <code class="docutils literal notranslate"><span class="pre">shapes</span></code> dict with the intensity
values of the shape for the that time-point.</p>
<p>The method is sent time step values and it yields at every time step
after the shapes dict is updated. The final time that was sent on
which it raises <a class="reference internal" href="#ceed.stage.StageDoneException" title="ceed.stage.StageDoneException"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageDoneException</span></code></a> means that the given time
was not used and the stage is done for that time value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shapes</strong> – A dict whose keys is the name of all the shapes of this
stage and its sub-stages. The corresponding values are empty lists.
At every iteration the list should be filled in with the desired
color values.</p></li>
<li><p><strong>last_end_t</strong> – the start time of the stage in globbal time.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><dl class="simple">
<dt><cite>StageDoneException</cite>:</dt><dd><p>When done with the stage (time is out of bounds). The time
value that raised this was not used.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.evaluate_pre_computed_stage">
<span class="sig-name descname"><span class="pre">evaluate_pre_computed_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_end_t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.evaluate_pre_computed_stage" title="Permalink to this definition"></a></dt>
<dd><p>Generator called by <a class="reference internal" href="#ceed.stage.CeedStage.tick_stage" title="ceed.stage.CeedStage.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tick_stage()</span></code></a> if the stage was
pre-computed. See that method for details.</p>
<p>This should not be overwritten, rather one can set
<a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a> to desired values and this method will iterate
through it.</p>
<p>If setting <a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a> manually, <a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_pre_compute()</span></code></a>
should be overwritten, otherwise it may overwrite
<a class="reference internal" href="#ceed.stage.CeedStage.runtime_stage" title="ceed.stage.CeedStage.runtime_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">runtime_stage</span></code></a> as it attempts to pre-compute again. But it’s
generally safer and simpler to customize <a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate_stage()</span></code></a> instead
and have Ceed generated the pre-compute values from it.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.evaluate_stage">
<span class="sig-name descname"><span class="pre">evaluate_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_end_t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.evaluate_stage" title="Permalink to this definition"></a></dt>
<dd><p>Generator called by <a class="reference internal" href="#ceed.stage.CeedStage.tick_stage" title="ceed.stage.CeedStage.tick_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tick_stage()</span></code></a> in real-time if the stage
won’t be pre-computed or before the stage is run if we’re
pre-computing the stage. See that method for details.</p>
<p>This method can safely be overwritten to set stage-shape values. And
if the stage will be pre-computed, this method will still be internally
called to get the shape values so pre-computing does not have to be
considered at all when overwriting this method.</p>
<p>However, <a class="reference internal" href="#ceed.stage.CeedStage.t_end" title="ceed.stage.CeedStage.t_end"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t_end</span></code></a> must be set with the final stage time before the
method ends, otherwise it’ll break the timing. Similarly,
<a class="reference internal" href="#ceed.stage.CeedStage.t_start" title="ceed.stage.CeedStage.t_start"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t_start</span></code></a> should be set the first time value of the stage.
Following is an appropriate customization (assuming those named shapes
exist in the GUI):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">last_end_t</span><span class="p">):</span>
    <span class="c1"># always get the first time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">t_start</span> <span class="o">=</span> <span class="n">t</span> <span class="o">=</span> <span class="k">yield</span>
    <span class="c1"># we ignore any looping and just use 10 time points.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># r, g, b, a values</span>
        <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;my shape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">last_end_t</span><span class="p">)),</span> <span class="mf">.2</span><span class="p">,</span>  <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.3</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;other shape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span>  <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.5</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># this yields so GUI can use the change shape colors</span>
        <span class="n">t</span> <span class="o">=</span> <span class="k">yield</span>

    <span class="c1"># this time value was not used and this effectively makes the</span>
    <span class="c1"># stage 10 samples long, and it ends on the last sample so</span>
    <span class="c1"># that last time will be used as start of next stage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">t_end</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">raise</span> <span class="n">StageDoneException</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.tick_stage_loop">
<span class="sig-name descname"><span class="pre">tick_stage_loop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_end_t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.tick_stage_loop" title="Permalink to this definition"></a></dt>
<dd><p>If the stage was not pre-computed, ticks through one loop iteration
of the stage yielding the shape values for each time-point.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.pre_compute_functions">
<span class="sig-name descname"><span class="pre">pre_compute_functions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">fractions.Fraction</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../function/function.html#ceed.function.FuncBase" title="ceed.function.FuncBase"><span class="pre">ceed.function.FuncBase</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.pre_compute_functions" title="Permalink to this definition"></a></dt>
<dd><p>Goes through all the stage’s functions and pre-computes those
that are finite and can be pre-computed.</p>
<p>Returns a list of pre-computed values/original functions, one for each
function of the stage. Each item is a 4-tuple of either
<code class="docutils literal notranslate"><span class="pre">(func,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None)</span></code> when the function is not finite, otherwise
<code class="docutils literal notranslate"><span class="pre">(None,</span> <span class="pre">pre_computed_values,</span> <span class="pre">logs,</span> <span class="pre">end_time)</span></code>.</p>
<p>This allows only some functions to be pre-computed.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.pre_compute_stage">
<span class="sig-name descname"><span class="pre">pre_compute_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">fractions.Fraction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.pre_compute_stage" title="Permalink to this definition"></a></dt>
<dd><p>If the stage is to be pre-computed, <a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_pre_compute()</span></code></a>
uses this to pre-compute the stage intensity values for all the
shapes for all time points when the stage would be active.</p>
<p>It returns the shape intensity values and data logs for all time points
as well as the end time when the stage ended relative to zero time (not
<code class="docutils literal notranslate"><span class="pre">t_start</span></code>).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.tick_funcs">
<span class="sig-name descname"><span class="pre">tick_funcs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">last_end_t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.tick_funcs" title="Permalink to this definition"></a></dt>
<dd><p>Iterates through the <a class="reference internal" href="#ceed.stage.CeedStage.functions" title="ceed.stage.CeedStage.functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">functions</span></code></a> of this stage sequentially
and returns the function’s value associated with the given time passed
in for each tick.</p>
<p>If the functions were pre-computed, it goes through the pre-computed
values, assuming the passed in time is exactly those values used
when pre-computing relative to <code class="docutils literal notranslate"><span class="pre">last_end_t</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.init_stage_tree">
<span class="sig-name descname"><span class="pre">init_stage_tree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.init_stage_tree" title="Permalink to this definition"></a></dt>
<dd><p>Before the stage is <a class="reference internal" href="#ceed.stage.CeedStage.apply_pre_compute" title="ceed.stage.CeedStage.apply_pre_compute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_pre_compute()</span></code></a> and started, the stage
and all sub-stages are recursively initialized.</p>
<p>Initializes the stage as part of the stage tree so it is ready
to be called to get the stage values as part of the tree. It is
called once for each stage of the entire stage tree.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>root</strong> – The root of the stage tree. If None, it’s self.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.apply_pre_compute">
<span class="sig-name descname"><span class="pre">apply_pre_compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pre_compute</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frame_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">fractions.Fraction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">fractions.Fraction</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.apply_pre_compute" title="Permalink to this definition"></a></dt>
<dd><p>Pre-computes the intensity values for all the shapes of this stage
and/or sub-stages, if enabled.</p>
<p>Depending on <code class="docutils literal notranslate"><span class="pre">pre_compute</span></code>, <a class="reference internal" href="#ceed.stage.CeedStage.can_pre_compute" title="ceed.stage.CeedStage.can_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_pre_compute</span></code></a>, and
<a class="reference internal" href="#ceed.stage.CeedStage.disable_pre_compute" title="ceed.stage.CeedStage.disable_pre_compute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">disable_pre_compute</span></code></a>, it pre-computes the full stage and
sub-stages, just the stage’s functions or only the sub-stages
recursively.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.resample_parameters">
<span class="sig-name descname"><span class="pre">resample_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent_tree</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_forked</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.resample_parameters" title="Permalink to this definition"></a></dt>
<dd><p>Resamples all parameters of all functions of the stage that have
randomness associated with it as well as <a class="reference internal" href="#ceed.stage.CeedStage.shuffled_order" title="ceed.stage.CeedStage.shuffled_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffled_order</span></code></a> if
<a class="reference internal" href="#ceed.stage.CeedStage.randomize_child_order" title="ceed.stage.CeedStage.randomize_child_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">randomize_child_order</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">parent_tree</span></code> is not inclusive. It is a list of stages starting from
the root stage leading up to this stage in the stage tree.</p>
<p>See <code class="xref py py-meth docutils literal notranslate"><span class="pre">FuncBase.resample_parameters()</span></code> and <a class="reference internal" href="#ceed.stage.CeedStage.copy_and_resample" title="ceed.stage.CeedStage.copy_and_resample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">copy_and_resample()</span></code></a>
for the meaning of <code class="docutils literal notranslate"><span class="pre">is_forked</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.copy_and_resample">
<span class="sig-name descname"><span class="pre">copy_and_resample</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></span><a class="headerlink" href="#ceed.stage.CeedStage.copy_and_resample" title="Permalink to this definition"></a></dt>
<dd><p>Resamples all the functions of the stage and <a class="reference internal" href="#ceed.stage.CeedStage.shuffled_order" title="ceed.stage.CeedStage.shuffled_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffled_order</span></code></a>,
copies and expands the stage, possibly resamples parameters, and returns
the duplicated stage.</p>
<p>It copies a stage so that the stage is ready to run in a experiment.
First it resamples all the parameters of all the functions that have
randomness associated with it and it resamples <a class="reference internal" href="#ceed.stage.CeedStage.shuffled_order" title="ceed.stage.CeedStage.shuffled_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffled_order</span></code></a>.
Then it copies and expends the stage and any sub-stages and functions
that refer to other functions/stages. Then, it
resamples again those randomized function parameters that are not
marked as
<a class="reference internal" href="../function/param_noise.html#ceed.function.param_noise.NoiseBase.lock_after_forked" title="ceed.function.param_noise.NoiseBase.lock_after_forked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lock_after_forked</span></code></a> as well
as <a class="reference internal" href="#ceed.stage.CeedStage.shuffled_order" title="ceed.stage.CeedStage.shuffled_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shuffled_order</span></code></a> if not <a class="reference internal" href="#ceed.stage.CeedStage.lock_after_forked" title="ceed.stage.CeedStage.lock_after_forked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lock_after_forked</span></code></a>. Those
will maintain their original re-sampled values so that all the expanded
copies of reference functions/stages have the same random values.</p>
<p>See <a class="reference internal" href="#ceed.stage.CeedStage.resample_parameters" title="ceed.stage.CeedStage.resample_parameters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resample_parameters()</span></code></a> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">FuncBase.resample_parameters()</span></code> as well.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.get_stage_shape_names">
<span class="sig-name descname"><span class="pre">get_stage_shape_names</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.get_stage_shape_names" title="Permalink to this definition"></a></dt>
<dd><p>Gets all the names of the shapes controlled by the stage or
substages. If adding names, you must call <code class="docutils literal notranslate"><span class="pre">super</span></code> to get the
builtin shapes.</p>
<p>It calls <a class="reference internal" href="#ceed.stage.CeedStage.get_stage_shape_names" title="ceed.stage.CeedStage.get_stage_shape_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_stage_shape_names()</span></code></a> on its children, recursively,
so any of them can be overwritten to return arbitrary names (that must
be unique among all the shapes).</p>
<p>This is used to create the shape logs in the HDF5 data file. Because
for each shape we create a Nx4 array, where N is the number of Ceed
time frames, and 4 is for the RGBA value for that frame
(<a class="reference internal" href="../analysis/analysis.html#ceed.analysis.CeedDataReader.shapes_intensity" title="ceed.analysis.CeedDataReader.shapes_intensity"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes_intensity</span></code></a>).</p>
<p>By default, it gets the name of the shapes from <a class="reference internal" href="#ceed.stage.CeedStage.shapes" title="ceed.stage.CeedStage.shapes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes</span></code></a> from
itself and its children stages. If you’re directly updating the
graphics, you can log rgba values by returning additional names here
and then setting their values when the stage is ticked, as if it was a
real shape. The values will then be accessible in
<a class="reference internal" href="../analysis/analysis.html#ceed.analysis.CeedDataReader.shapes_intensity" title="ceed.analysis.CeedDataReader.shapes_intensity"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shapes_intensity</span></code></a>.</p>
<p>If you set the values of the additional shapes when the stage is ticked,
then the values will also show in the stage preview graph so you can use
it to display arbitrary rgb data for your stage in the graph. But it
must be logged during stage tick (e.g. <a class="reference internal" href="#ceed.stage.CeedStage.evaluate_stage" title="ceed.stage.CeedStage.evaluate_stage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate_stage()</span></code></a>), not
during the actual graphing in <a class="reference internal" href="#ceed.stage.CeedStage.set_gl_colors" title="ceed.stage.CeedStage.set_gl_colors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_gl_colors()</span></code></a> that follows each
tick.</p>
<p>See the stage example plugins for example usage.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.set_ceed_id">
<span class="sig-name descname"><span class="pre">set_ceed_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_available</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.set_ceed_id" title="Permalink to this definition"></a></dt>
<dd><p>Sets the ID of this and any sub objects, each to a number equal or
greater than <code class="docutils literal notranslate"><span class="pre">min_available</span></code> and returns the next minimum number
available to be used.</p>
<p>See <a class="reference internal" href="../analysis/analysis.html#ceed.analysis.CeedDataReader.event_data" title="ceed.analysis.CeedDataReader.event_data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">event_data</span></code></a> for more details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>min_available</strong> – The minimum number available to be used for the
ID so it is unique.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The next minimum available number that can be used. Any number
larger or equal to it is free to be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.get_ref_src">
<span class="sig-name descname"><span class="pre">get_ref_src</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></span><a class="headerlink" href="#ceed.stage.CeedStage.get_ref_src" title="Permalink to this definition"></a></dt>
<dd><p>Returns the stage referenced by this object if we are a
<a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a>, otherwise it just returns this stage.</p>
<p>Useful to get the referenced stage without having to check whether we
are a <a class="reference internal" href="#ceed.stage.CeedStageRef" title="ceed.stage.CeedStageRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStageRef</span></code></a>. I.e. <code class="docutils literal notranslate"><span class="pre">stage.get_ref_src().name</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.add_gl_to_canvas">
<span class="sig-name descname"><span class="pre">add_gl_to_canvas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">screen_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">screen_height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">canvas</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html#kivy.graphics.instructions.Canvas" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.instructions.Canvas</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quad_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.add_gl_to_canvas" title="Permalink to this definition"></a></dt>
<dd><p>Should add any stage specific kivy OpenGL instructions that a
stage may manually set.</p>
<p>This is called by Ceed when it creates a new experiment to get all the
graphics for the stage and substages used during an experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>screen_width</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>.</p></li>
<li><p><strong>screen_height</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>.</p></li>
<li><p><strong>canvas</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>.</p></li>
<li><p><strong>name</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>.</p></li>
<li><p><strong>quad_mode</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>.</p></li>
<li><p><strong>quad</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.add_manual_gl_to_canvas" title="ceed.stage.StageFactoryBase.add_manual_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_manual_gl_to_canvas()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether the stage added custom graphics. If True,
<a class="reference internal" href="#ceed.stage.CeedStage.set_gl_colors" title="ceed.stage.CeedStage.set_gl_colors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_gl_colors()</span></code></a> will be called for this stage for every Ceed
frame. Otherwise, it is not called. Defaults to returning None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.set_gl_colors">
<span class="sig-name descname"><span class="pre">set_gl_colors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">quad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grayscale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.set_gl_colors" title="Permalink to this definition"></a></dt>
<dd><p>If <a class="reference internal" href="#ceed.stage.CeedStage.add_gl_to_canvas" title="ceed.stage.CeedStage.add_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_gl_to_canvas()</span></code></a> returned True, it is called by Ceed for
every time step to allow the stage to update the manually added gl
instructions for this frame. In QUAD4X it’s called
4 times per frame, in QUAD121X it’s called 12 times per frame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>quad</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.set_manual_gl_colors" title="ceed.stage.StageFactoryBase.set_manual_gl_colors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_manual_gl_colors()</span></code></a>.</p></li>
<li><p><strong>grayscale</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.set_manual_gl_colors" title="ceed.stage.StageFactoryBase.set_manual_gl_colors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_manual_gl_colors()</span></code></a>.</p></li>
<li><p><strong>clear</strong> – Same as
<a class="reference internal" href="#ceed.stage.StageFactoryBase.set_manual_gl_colors" title="ceed.stage.StageFactoryBase.set_manual_gl_colors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_manual_gl_colors()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For every clock tick, Ceed “ticks” the stage and then updates the
graphics based on the values computed during the tick. If the frame
is not dropped, the value is then applied to the graphics.</p>
<p>For shapes, Ceed does this automatically, only updating the shapes
when the frame is not dropped, for each tick. For these manual gl
graphics, the stage should only update the graphics in this method.
Normally, every tick is followed by a call to this method to draw.
If the frame is dropped, the draw call does not follow the tick.
Hence, only draw in this method.</p>
<p>If the stage is pre-computed, then Ceed ticks through the stage
before the stage runs. During the stage, tick won’t be called,
but this method will still be called so you have to work out the
timing prior and apply it during this method.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStage.remove_gl_from_canvas">
<span class="sig-name descname"><span class="pre">remove_gl_from_canvas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">canvas</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html#kivy.graphics.instructions.Canvas" title="(in Kivy v2.1.0)"><span class="pre">kivy.graphics.instructions.Canvas</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.CeedStage.remove_gl_from_canvas" title="Permalink to this definition"></a></dt>
<dd><p>Should remove all the gl instructions that was added with
<a class="reference internal" href="#ceed.stage.CeedStage.add_gl_to_canvas" title="ceed.stage.CeedStage.add_gl_to_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_gl_to_canvas()</span></code></a>.</p>
<p>It is called by Ceed for the root stage and all substages after the
experiment is done. It should remove all the instructions added.
Instructions added with this <code class="docutils literal notranslate"><span class="pre">name</span></code> will be
automatically removed by
<a class="reference internal" href="#ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas" title="ceed.stage.StageFactoryBase.remove_shapes_gl_from_canvas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_shapes_gl_from_canvas()</span></code></a> so they
don’t have to be removed manually.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>canvas</strong> – The Kivy canvas instance to which the gl instructions
was added.</p></li>
<li><p><strong>name</strong> – The name associated with these OpenGL instructions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ceed.stage.StageShape">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">StageShape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><span class="pre">ceed.shape.CeedShape</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShapeGroup" title="ceed.shape.CeedShapeGroup"><span class="pre">ceed.shape.CeedShapeGroup</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.StageShape" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">kivy._event.EventDispatcher</span></code></p>
<p>A wrapper for <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a> instances used in
<a class="reference internal" href="#ceed.stage.CeedStage.add_shape" title="ceed.stage.CeedStage.add_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.add_shape()</span></code></a> to wrap a shape or shape group to be used by
the stage.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageShape.name">
<span class="sig-name descname"><span class="pre">name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#ceed.stage.StageShape.name" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShapeGroup.name" title="ceed.shape.CeedShapeGroup.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ceed.shape.CeedShapeGroup.name</span></code></a> or
<code class="xref py py-attr docutils literal notranslate"><span class="pre">kivy_garden.painter.PaintShape.name</span></code> of the instance wrapped.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageShape.keep_dark">
<span class="sig-name descname"><span class="pre">keep_dark</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#ceed.stage.StageShape.keep_dark" title="Permalink to this definition"></a></dt>
<dd><p>Whether this shape will be black during the whole stage. Instead of it
taking the color of the stage, it’ll be kept black.</p>
<p>This is useful when the inside of some shape must be black, e.g. a donut.
By setting <a class="reference internal" href="#ceed.stage.StageShape.keep_dark" title="ceed.stage.StageShape.keep_dark"><code class="xref py py-attr docutils literal notranslate"><span class="pre">keep_dark</span></code></a> of the inner shape to True, it’ll be black.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageShape.stage">
<span class="sig-name descname"><span class="pre">stage</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.StageShape.stage" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> this is associated with.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.StageShape.shape">
<span class="sig-name descname"><span class="pre">shape</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><span class="pre">ceed.shape.CeedShape</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShapeGroup" title="ceed.shape.CeedShapeGroup"><span class="pre">ceed.shape.CeedShapeGroup</span></a><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.StageShape.shape" title="Permalink to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShape" title="ceed.shape.CeedShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShape</span></code></a> or <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedShapeGroup" title="ceed.shape.CeedShapeGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ceed.shape.CeedShapeGroup</span></code></a>
instance being wrapped.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageShape.get_config">
<span class="sig-name descname"><span class="pre">get_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#ceed.stage.StageShape.get_config" title="Permalink to this definition"></a></dt>
<dd><p>(internal) used by the config system to get the config data of the
shape.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.StageShape.apply_config">
<span class="sig-name descname"><span class="pre">apply_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.StageShape.apply_config" title="Permalink to this definition"></a></dt>
<dd><p>(internal) used by the config system to set the config data
of the shape.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">CeedStageRef</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><span class="pre">ceed.stage.StageFactoryBase</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../function/function.html#ceed.function.FunctionFactoryBase" title="ceed.function.FunctionFactoryBase"><span class="pre">ceed.function.FunctionFactoryBase</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><span class="pre">ceed.shape.CeedPaintCanvasBehavior</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.CeedStageRef" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A stage that refers to another stage.</p>
<p>This is never manually created, but rather returned by
<a class="reference internal" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="ceed.stage.StageFactoryBase.get_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.get_stage_ref()</span></code></a>.
See <a class="reference internal" href="#ceed.stage.StageFactoryBase.get_stage_ref" title="ceed.stage.StageFactoryBase.get_stage_ref"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StageFactoryBase.get_stage_ref()</span></code></a> and <a class="reference internal" href="#module-ceed.stage" title="ceed.stage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ceed.stage</span></code></a> for
details.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef.display">
<span class="sig-name descname"><span class="pre">display</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStageRef.display" title="Permalink to this definition"></a></dt>
<dd><p>Same as <a class="reference internal" href="#ceed.stage.CeedStage.display" title="ceed.stage.CeedStage.display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.display</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef.parent_stage">
<span class="sig-name descname"><span class="pre">parent_stage</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStageRef.parent_stage" title="Permalink to this definition"></a></dt>
<dd><p>Same as <a class="reference internal" href="#ceed.stage.CeedStage.parent_stage" title="ceed.stage.CeedStage.parent_stage"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.parent_stage</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef.stage">
<span class="sig-name descname"><span class="pre">stage</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStageRef.stage" title="Permalink to this definition"></a></dt>
<dd><p>The reffered to stage.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef.stage_factory">
<span class="sig-name descname"><span class="pre">stage_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><span class="pre">ceed.stage.StageFactoryBase</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStageRef.stage_factory" title="Permalink to this definition"></a></dt>
<dd><p>Same as <a class="reference internal" href="#ceed.stage.CeedStage.stage_factory" title="ceed.stage.CeedStage.stage_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.stage_factory</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef.shape_factory">
<span class="sig-name descname"><span class="pre">shape_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><span class="pre">ceed.shape.CeedPaintCanvasBehavior</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStageRef.shape_factory" title="Permalink to this definition"></a></dt>
<dd><p>Same as <a class="reference internal" href="#ceed.stage.CeedStage.shape_factory" title="ceed.stage.CeedStage.shape_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.shape_factory</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef.function_factory">
<span class="sig-name descname"><span class="pre">function_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../function/function.html#ceed.function.FunctionFactoryBase" title="ceed.function.FunctionFactoryBase"><span class="pre">ceed.function.FunctionFactoryBase</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ceed.stage.CeedStageRef.function_factory" title="Permalink to this definition"></a></dt>
<dd><p>Same as <a class="reference internal" href="#ceed.stage.CeedStage.function_factory" title="ceed.stage.CeedStage.function_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CeedStage.function_factory</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ceed.stage.CeedStageRef.get_ref_src">
<span class="sig-name descname"><span class="pre">get_ref_src</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><span class="pre">ceed.stage.CeedStage</span></a></span></span><a class="headerlink" href="#ceed.stage.CeedStageRef.get_ref_src" title="Permalink to this definition"></a></dt>
<dd><p>See <a class="reference internal" href="#ceed.stage.CeedStage.get_ref_src" title="ceed.stage.CeedStage.get_ref_src"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CeedStage.get_ref_src()</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ceed.stage.remove_shapes_upon_deletion">
<span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">remove_shapes_upon_deletion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><span class="pre">ceed.stage.StageFactoryBase</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><span class="pre">ceed.shape.CeedPaintCanvasBehavior</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_shape_callback</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ceed.stage.remove_shapes_upon_deletion" title="Permalink to this definition"></a></dt>
<dd><p>Once called, whenever a shape or group of shapes is deleted in the
<code class="docutils literal notranslate"><span class="pre">shape_factory</span></code>, it’ll also remove the shape or shape group from all
stages that reference it.</p>
<p>This is automatically called by the Ceed GUI, but should be manually called
if manually creating these factories.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage_factory</strong> – The <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> that lists all the
stages.</p></li>
<li><p><strong>shape_factory</strong> – The <a class="reference internal" href="../shape/shape.html#ceed.shape.CeedPaintCanvasBehavior" title="ceed.shape.CeedPaintCanvasBehavior"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedPaintCanvasBehavior</span></code></a> that
lists all the shapes.</p></li>
<li><p><strong>process_shape_callback</strong> – For each stage in <code class="docutils literal notranslate"><span class="pre">stage_factory</span></code> that
contains the shape, <code class="docutils literal notranslate"><span class="pre">process_shape_callback</span></code> will be called with 2
parameters: the <a class="reference internal" href="#ceed.stage.CeedStage" title="ceed.stage.CeedStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeedStage</span></code></a> and <a class="reference internal" href="#ceed.stage.StageShape" title="ceed.stage.StageShape"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageShape</span></code></a> instances.
The callback may e.g. then hide the shape in the GUI or whatever else
it needs.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ceed.stage.register_all_stages">
<span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">register_all_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><span class="pre">ceed.stage.StageFactoryBase</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.register_all_stages" title="Permalink to this definition"></a></dt>
<dd><p>Registers all the internal plugins and built-in stages with the
<a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> instance.</p>
<p>It gets and registers all the plugins stages under
<code class="docutils literal notranslate"><span class="pre">ceed/stage/plugin</span></code> using <a class="reference internal" href="stage_plugin.html#ceed.stage.plugin.get_plugin_stages" title="ceed.stage.plugin.get_plugin_stages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_plugin_stages()</span></code></a>.
See that function for how to make your plugin stages discoverable.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>stage_factory</strong> – a <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ceed.stage.register_external_stages">
<span class="sig-prename descclassname"><span class="pre">ceed.stage.</span></span><span class="sig-name descname"><span class="pre">register_external_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><span class="pre">ceed.stage.StageFactoryBase</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">package</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceed.stage.register_external_stages" title="Permalink to this definition"></a></dt>
<dd><p>Registers all the plugin stages in the package with the
<a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> instance.</p>
<p>See <a class="reference internal" href="stage_plugin.html#ceed.stage.plugin.get_plugin_stages" title="ceed.stage.plugin.get_plugin_stages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_plugin_stages()</span></code></a> for how to make your
plugin stages discoverable.</p>
<p>Plugin source code files are copied to the data file when a a data file is
created. However, it doesn’t copy all files (i.e. it ignores non-python
files) so it should be independently tracked for each experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage_factory</strong> – A <a class="reference internal" href="#ceed.stage.StageFactoryBase" title="ceed.stage.StageFactoryBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">StageFactoryBase</span></code></a> instance.</p></li>
<li><p><strong>package</strong> – The name of the package containing the plugins.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.html" class="btn btn-neutral float-left" title="Stage API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="stage_plugin.html" class="btn btn-neutral float-right" title="Stage plugins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Matthew Einhorn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>